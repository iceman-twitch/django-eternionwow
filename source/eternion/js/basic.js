if(typeof WH==="undefined"){var WH={data:{},entities:{}}}WH.staticUrl=typeof g_staticUrl=="string"?g_staticUrl:"https://wow.zamimg.com";if(!Function.prototype.bind){Function.prototype.bind=function(){var a=this,c=Array.prototype.slice.call(arguments),b=c.shift();return function(){return a.apply(b,c.concat(Array.prototype.slice.call(arguments)))}}}if(!String.prototype.ltrim){String.prototype.ltrim=function(){return this.replace(/^\s*/,"")}}if(!String.prototype.rtrim){String.prototype.rtrim=function(){return this.replace(/\s*$/,"")}}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/(^\s*|\s*$)/g,"")}}WH.error=function(a){if(typeof console!=="undefined"&&typeof console.error==="function"){console.error.apply(console.error,Array.prototype.slice.call(arguments))}};WH.info=function(a){if(typeof console!=="undefined"&&typeof console.info==="function"){console.info.apply(console.info,Array.prototype.slice.call(arguments))}};WH.log=function(a){if(typeof console!=="undefined"&&typeof console.log==="function"){console.log.apply(console.log,Array.prototype.slice.call(arguments))}};WH.data.get=function(b){var a=WH.data;b=Array.prototype.slice.call(arguments);while(b.length){if(a[b[0]]){a=a[b.shift()]}else{return null}}return a};WH.data.set=function(a,b){return WH.setValueOnObject(WH.data,a,b)};WH.setValueOnObject=function(b,d,e,f){if(typeof d==="number"||typeof d==="string"){b[d]=e;return true}if(!(d instanceof Array)){WH.error("Invalid key type passed to WH.setValueOnObject:",typeof d,b,d,e);return false}if(d.length<1){WH.error("WH.setValueOnObject called with an empty key list:",b,d,e);return false}while(d.length>1){var a=d.shift();if(typeof b[a]==="undefined"){b[a]={}}if(typeof b[a]!=="object"){WH.error("Dead end while setting value on object.",b,d,e);return false}b=b[a]}if(f){var c=d.shift();if(typeof b[c]==="undefined"){b[c]=e}}else{b[d.shift()]=e}return true};WH.normalizeEvent=function(a){if(!a){if(typeof window.event!="undefined"){a=window.event}else{return null}}if(a.which){a._button=a.which}else{a._button=a.button;if(WH.Browser.ie6789&&a._button){if(a._button&4){a._button=2}else{if(a._button&2){a._button=3}}}else{a._button=a.button+1}}a._target=a.target||a.srcElement;a._wheelDelta=a.wheelDelta||-a.detail;return a};WH.stringCompare=function(d,c){if(d==c){return 0}if(d==null){return -1}if(c==null){return 1}var f=parseFloat(d);var e=parseFloat(c);if(!isNaN(f)&&!isNaN(e)&&f!=e){return f<e?-1:1}if(typeof d=="string"&&typeof c=="string"){return d.localeCompare(c)}return d<c?-1:1};WH.trim=function(a){return a.replace(/(^\s*|\s*$)/g,"")};WH.rtrim=function(b,c){var a=b.length;while(--a>0&&b.charAt(a)==c){}b=b.substring(0,a+1);if(b==c){b=""}return b};WH.sprintf=function(c){for(var b=1,a=arguments.length;b<a;++b){c=c.replace("$"+b,arguments[b])}return c};WH.sprintfGlobal=function(c){for(var b=1,a=arguments.length;b<a;++b){c=c.replace(new RegExp("\\$"+b,"g"),arguments[b])}return c};WH.stringReplace=function(c,b,a){while(c.indexOf(b)!=-1){c=c.replace(b,a)}return c};WH.htmlEntities=function(a){return a.replace(/[\u00A0-\u9999<>\&]/gim,function(b){return"&#"+b.charCodeAt(0)+";"})};WH.urlEncode=function(a){a=encodeURIComponent(a);a=WH.stringReplace(a,"+","%2B");return a};WH.urlEncodeHref=function(a){a=encodeURIComponent(a);a=WH.stringReplace(a,"%20","+");a=WH.stringReplace(a,"%3D","=");return a};WH.numberFormat=function(b){var c=(""+parseFloat(b)).split(".");b=c[0];var a=c.length>1?"."+c[1]:"";if(b.length<=3){return b+a}return WH.numberFormat(b.substr(0,b.length-3))+","+b.substr(b.length-3)+a};WH.numberLocaleFormat=function(d,b){var c="";if(typeof b=="number"){c=Locale.locales[b].name}else{if(typeof b=="string"){c=b}else{c=Locale.getName()}}if(c.length==4){c=c.substr(0,2).toLowerCase()+"-"+c.substr(2).toUpperCase()}var a=""+d;try{a=d.toLocaleString(c)}catch(f){a=d.toLocaleString()}return a};WH.isArray=function(a){return !!(a&&a.constructor==Array)};WH.inArray=function(f,g,b,e){if(f==null){return -1}var a;if(b){a=f.length;for(var d=e||0;d<a;++d){if(b(f[d])==g){return d}}return -1}a=f.length;for(var c=e||0;c<a;++c){if(f[c]==g){return c}}return -1};WH.isSet=function(a){return typeof window[a]!=="undefined"};if(!WH.isSet("console")){var console={log:function(){}}}WH.arrayWalk=function(f,e,c){for(var d=0,b=f.length;d<b;++d){var a=e(f[d],c,f,d);if(a!=null){f[d]=a}}};WH.arrayApply=function(e,d,b){for(var c=0,a=e.length;c<a;++c){d(e[c],b,e,c)}};WH.arrayFilter=function(e,d){var b=[];for(var c=0,a=e.length;c<a;++c){if(d(e[c])){b.push(e[c])}}return b};WH.arrayUnique=function(e){var b={};for(var c=e.length-1;c>=0;--c){b[e[c]]=1}var a=[];for(var d in b){a.push(d)}return a};WH.ge=function(a){if(typeof a!="string"){return a}return document.getElementById(a)};WH.gE=function(b,a){return b.getElementsByTagName(a)};WH.ce=function(a,b,c){};WH.ce=(function(a){return function(b,d,e){var c=a(b);if(d){WH.cOr(c,d)}if(e){WH.ae(c,e)}return c}})(typeof document.createElementOriginal==="function"?document.createElementOriginal.bind(document):document.createElement.bind(document));WH.de=function(a){if(!a||!a.parentNode){return}a.parentNode.removeChild(a)};WH.ae=function(a,b){if(WH.isArray(b)){WH.arrayApply(b,a.appendChild.bind(a));return b}else{return a.appendChild(b)}};WH.aef=function(a,b){return a.insertBefore(b,a.firstChild)};WH.ee=function(b,a){if(!a){a=0}while(b.childNodes[a]){b.removeChild(b.childNodes[a])}};WH.ct=function(a){return document.createTextNode(a)};WH.st=function(a,b){if(a.firstChild&&a.firstChild.nodeType==3){a.firstChild.nodeValue=b}else{WH.aef(a,WH.ct(b))}};WH.noWrap=function(a){a.style.whiteSpace="nowrap"};WH.rf=function(){return false};WH.rfWithoutControlKey=function(a){a=WH.normalizeEvent(a);if(a.ctrlKey||a.shiftKey||a.altKey||a.metaKey){return}return false};WH.aE=function(b,a,c){if(b.addEventListener){b.addEventListener(a,c,false)}else{if(b.attachEvent){b.attachEvent("on"+a,c)}}};WH.dE=function(b,a,c){if(b.removeEventListener){b.removeEventListener(a,c,false)}else{if(b.detachEvent){b.detachEvent("on"+a,c)}}};WH.sp=function(a){if(!a){a=window.event}if(WH.Browser.ie6789){a.cancelBubble=true}else{a.stopPropagation()}};WH.setCookie=function(b,g,e,f,d){var a=new Date();var c=b+"="+encodeURI(e)+"; ";a.setDate(a.getDate()+g);c+="expires="+a.toUTCString()+"; ";if(f){c+="path="+f+"; "}if(d){c+="domain="+d+"; "}document.cookie=c;WH.getCookies(b);WH.getCookies.C[b]=e};WH.deleteCookie=function(a){WH.setCookie(a,-1);WH.getCookies.C[a]=null};WH.getCookies=function(b){if(WH.getCookies.I==null){var e=decodeURI(document.cookie).split("; ");WH.getCookies.C={};for(var c=0,a=e.length;c<a;++c){var g=e[c].indexOf("="),f,d;if(g!=-1){f=e[c].substr(0,g);d=e[c].substr(g+1)}else{f=e[c];d=""}WH.getCookies.C[f]=d}WH.getCookies.I=1}if(!b){return WH.getCookies.C}else{return WH.getCookies.C[b]}};WH.disableOldIESelect=function(a){if(WH.Browser.ie6789){a.onfocus=function(){this.blur()};a.onmousedown=a.onselectstart=a.ondragstart=WH.rf}};WH.dO=function(a){function b(){}b.prototype=a;return new b};WH.cO=function(c,b){for(var a in b){if(b[a]!==null&&typeof b[a]=="object"&&b[a].length){c[a]=b[a].slice(0)}else{c[a]=b[a]}}return c};WH.cOr=function(d,c,b){for(var a in c){if(b&&(a.substr(0,b.length)==b)){continue}if(c[a]!==null&&typeof c[a]=="object"){if(c[a].length){d[a]=c[a].slice(0)}else{if(!d[a]){d[a]={}}WH.cOr(d[a],c[a],b)}}else{d[a]=c[a]}}return d};WH.fround=function(b){if(Math.fround){return Math.fround(b)}else{if(typeof Float32Array!="undefined"&&Float32Array){var a=new Float32Array(1);a[0]=+b;return a[0]}else{return b}}};WH.Browser={ie:!!(window.attachEvent&&!window.opera),opera:!!window.opera,safari:navigator.userAgent.indexOf("Safari")!=-1,firefox:navigator.userAgent.indexOf("Firefox")!=-1,chrome:navigator.userAgent.indexOf("Chrome")!=-1};WH.Browser.ie9=WH.Browser.ie&&navigator.userAgent.indexOf("MSIE 9.0")!=-1;WH.Browser.ie8=WH.Browser.ie&&navigator.userAgent.indexOf("MSIE 8.0")!=-1&&!WH.Browser.ie9;WH.Browser.ie7=WH.Browser.ie&&navigator.userAgent.indexOf("MSIE 7.0")!=-1&&!WH.Browser.ie8;WH.Browser.ie6=WH.Browser.ie&&navigator.userAgent.indexOf("MSIE 6.0")!=-1&&!WH.Browser.ie7;WH.Browser.ie67=WH.Browser.ie6||WH.Browser.ie7;WH.Browser.ie678=WH.Browser.ie67||WH.Browser.ie8;WH.Browser.ie6789=WH.Browser.ie678||WH.Browser.ie9;WH.OS={windows:navigator.appVersion.indexOf("Windows")!=-1,mac:navigator.appVersion.indexOf("Macintosh")!=-1,linux:navigator.appVersion.indexOf("Linux")!=-1};WH.localStorage=new function(){this.isSupported=function(){var a;try{a="localStorage" in window&&window.localStorage!==null}catch(b){a=false}if(a){try{localStorage.setItem("test","123");a=localStorage.getItem("test")=="123";localStorage.removeItem("test")}catch(b){a=false}}WH.localStorage.isSupported=(function(c){return c}).bind(null,a);return a};this.set=function(a,b){if(!WH.localStorage.isSupported()){return}localStorage.setItem(a,b)};this.get=function(a){if(!WH.localStorage.isSupported()){return}return localStorage.getItem(a)};this.remove=function(a){if(!WH.localStorage.isSupported()){return}localStorage.removeItem(a)}};WH.sessionStorage=new function(){this.isSupported=function(){var a;try{a="sessionStorage" in window&&window.sessionStorage!==null}catch(b){a=false}if(a){try{sessionStorage.setItem("test","123");a=sessionStorage.getItem("test")=="123";sessionStorage.removeItem("test")}catch(b){a=false}}WH.sessionStorage.isSupported=(function(c){return c}).bind(null,a);return a};this.set=function(a,b){if(!WH.sessionStorage.isSupported()){return}sessionStorage.setItem(a,b)};this.get=function(a){if(!WH.sessionStorage.isSupported()){return}return sessionStorage.getItem(a)};this.remove=function(a){if(!WH.sessionStorage.isSupported()){return}sessionStorage.removeItem(a)}};WH.getWindowSize=function(){var b=0,a=0;if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){b=document.documentElement.clientWidth;a=document.documentElement.clientHeight}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){b=document.body.clientWidth;a=document.body.clientHeight}else{if(typeof window.innerWidth=="number"){b=window.innerWidth;a=window.innerHeight}}}return{w:b,h:a}};WH.getScroll=function(){var a=0,b=0;if(typeof window.pageYOffset=="number"){a=window.pageXOffset;b=window.pageYOffset}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){a=document.body.scrollLeft;b=document.body.scrollTop}else{if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){a=document.documentElement.scrollLeft;b=document.documentElement.scrollTop}}}return{x:a,y:b}};WH.getCursorPos=function(c){var b,d;if(window.innerHeight){b=c.pageX;d=c.pageY}else{var a=WH.getScroll();b=c.clientX+a.x;d=c.clientY+a.y}return{x:b,y:d}};WH.ac=function(f,d){var c=0,g=0,e;while(f){c+=f.offsetLeft;g+=f.offsetTop;e=f.parentNode;while(e&&e!=f.offsetParent&&e.offsetParent){if(e.scrollLeft||e.scrollTop){c-=(e.scrollLeft|0);g-=(e.scrollTop|0);break}e=e.parentNode}f=f.offsetParent}if(WH.isSet("Lightbox")&&Lightbox.isVisible()){d=true}if(d){var b=WH.getScroll();c+=b.x;g+=b.y}var a=[c,g];a.x=c;a.y=g;return a};WH.scrollTo=function(c,b){var o,l=WH.getWindowSize(),m=WH.getScroll(),j=l.w,e=l.h,g=m.x,d=m.y;c=WH.ge(c);if(b==null){b=[]}else{if(typeof b=="number"){b=[b]}}o=b.length;if(o==0){b[0]=b[1]=b[2]=b[3]=0}else{if(o==1){b[1]=b[2]=b[3]=b[0]}else{if(o==2){b[2]=b[0];b[3]=b[1]}else{if(o==3){b[3]=b[1]}}}}o=WH.ac(c);var a=o[0]-b[3],h=o[1]-b[0],k=o[0]+c.offsetWidth+b[1],f=o[1]+c.offsetHeight+b[2];if(k-a>j||a<g){g=a}else{if(k-j>g){g=k-j}}if(f-h>e||h<d){d=h}else{if(f-e>d){d=f-e}}scrollTo(g,d)};WH.createReverseLookupJson=function(c){var a={};for(var b in c){a[c[b]]=b}return a};WH.getLocaleFromDomain=function(b){var d=WH.getLocaleFromDomain.L;if(b&&(typeof b=="string")){var c=b.split(".");for(var a=0;a<c.length;a++){if(c[a] in d){return d[c[a]]}}}return 0};WH.getLocaleFromDomain.L={ko:1,fr:2,de:3,cn:4,es:6,ru:7,pt:8,it:9,legion:"beta",bfa:"beta",www:0};WH.getDomainFromLocale=function(b){var f;if(WH.getDomainFromLocale.L){f=WH.getDomainFromLocale.L}else{f=WH.getDomainFromLocale.L=WH.createReverseLookupJson(WH.getLocaleFromDomain.L);if((typeof g_dev!="undefined")&&g_dev){var g="",d="",e;e=document.location.hostname.split(".");e.splice(-2,2);for(var a=0;a<e.length;a++){if(e[a] in WH.getLocaleFromDomain.L){continue}if(/staging\d*/.test(e[a])){g=g+"."+e[a]}else{d=d+e[a]+"."}}for(var c in WH.getDomainFromLocale.L){if(c==0){WH.getDomainFromLocale.L[c]=(d+g).replace(/\.+/g,".").replace(/^\./,"").replace(/\.$/,"")}else{WH.getDomainFromLocale.L[c]=d+WH.getDomainFromLocale.L[c]+g}}}}return(f[b]?f[b]:"www")};WH.getIdFromTypeName=function(a){var b=WH.getIdFromTypeName.L;return(b[a]?b[a]:-1)};WH.getIdFromTypeName.L={npc:1,object:2,item:3,itemset:4,"item-set":4,quest:5,spell:6,zone:7,faction:8,pet:9,achievement:10,title:11,event:12,statistic:16,currency:17,building:20,follower:21,garrisonability:22,missionability:22,"mission-ability":22,mission:23,ship:25,threat:26,resource:27,champion:28,icon:29,"order-advancement":30,"bfa-champion":38,affix:40,guide:100,"transmog-set":101,outfit:110,petability:200,"pet-ability":200};WH.ajaxIshRequest=function(b,e){var c=document.getElementsByTagName("head")[0];if(b.substr(0,5)=="http:"&&location.protocol=="https:"){if(typeof console!="undefined"&&console){var d="Refused to ajaxish load "+b+" from "+location.href;if(typeof console.log=="function"){console.log(d)}else{if(typeof console.error=="function"){console.error(d)}}}return false}if(e){WH.ae(c,WH.ce("script",{type:"text/javascript",src:b}));return}var a=WH.getGets();if(a.refresh!=null){if(a.refresh.length){b+=("&refresh="+a.refresh)}else{b+="&refresh"}}if(a.locale!=null){b+="&locale="+a.locale}if(a.ptr!=null){b+="&ptr"}WH.ae(c,WH.ce("script",{type:"text/javascript",src:b,charset:"utf8"}))};WH.xhrJsonRequest=function(a,c){var b=new XMLHttpRequest();b.onload=c;b.open("GET",a,true);b.responseType="json";b.send()};WH.getGets=function(){if(WH.getGets.C!=null){return WH.getGets.C}var b=WH.getQueryString();var a=WH.parseQueryString(b);WH.getGets.C=a;return a};WH.convertNodesToHtml=function(a){var b=WH.ce("div");WH.ae(b,a);return b.innerHTML};WH.escapeHtml=function(a){var b=WH.ce("div");WH.ae(b,WH.ct(a));return b.innerHTML};WH.visitUrlWithPostData=function(b,d){var c=WH.ce("form");c.action=b;c.method="post";for(var a in d){if(d.hasOwnProperty(a)){var e=WH.ce("input");e.type="hidden";e.name=a;e.value=d[a];WH.ae(c,e)}}WH.ae(document.body,c);c.submit()};WH.getQueryString=function(){var a="";if(location.pathname){a+=location.pathname.substr(1)}if(location.search){if(location.pathname){a+="&"}a+=location.search.substr(1)}return a};WH.parseQueryString=function(e){e=decodeURIComponent(e);var d=e.split("&");var c={};for(var b=0,a=d.length;b<a;++b){WH.splitQueryParam(d[b],c)}return c};WH.splitQueryParam=function(c,d){var e=c.indexOf("=");var a;var b;if(e!=-1){a=c.substr(0,e);b=c.substr(e+1)}else{a=c;b=""}d[a]=b};WH.createRect=function(d,c,b,a){return{l:d,t:c,r:d+b,b:c+a}};WH.intersectRect=function(d,c){return !(d.l>=c.r||c.l>=d.r||d.t>=c.b||c.t>=d.b)};WH.getViewport=function(){var a=$(window);return new Rectangle(a.scrollLeft(),a.scrollTop(),a.width(),a.height())};WH.keyPressIsAlphaNumeric=function(b){var a=document.all?b.keycode:b.which;return((a>47&&a<58)||(a>64&&a<91)||(a>95&&a<112)||a==222||a==0)};WH.isRemote=function(){return typeof g_wowhead=="undefined"||!g_wowhead};WH.isDev=function(){return typeof g_dev!="undefined"&&g_dev};WH.isBeta=function(){return typeof g_beta!="undefined"&&g_beta};WH.betaIsActive=function(){return typeof g_betaactive!="undefined"&&g_betaactive};WH.isPtr=function(){return typeof g_ptr!="undefined"&&g_ptr};WH.ptrIsActive=function(){return typeof g_ptractive!="undefined"&&g_ptractive};WH.setupFooterMenus=function(){var b={"footer-help-menu":mn_footer_help,"footer-tools-menu":mn_footer_tools,"footer-about-menu":mn_footer_about};for(var c in b){if(!b.hasOwnProperty(c)){continue}var a=$("#"+c);if(a.length){a.addClass("hassubmenu");Menu.add(a.get(0),b[c])}}};WH.getConfidenceInterval=function(c,b){if(c==0&&b==0){return 0}var e=1.96,d=1*c/b;var a=(d+e*e/(2*b)-e*Math.sqrt((d*(1-d)+e*e/(4*b))/b))/(1+e*e/b);if(isNaN(a)||a==0){return(b*-1+c)/10000}return a};WH.getScreenshotUrl=function(d,b,c){if(!b){b="normal"}var a=b=="normal"&&typeof c=="string"&&c?"-"+WH.urlize(c,true):"";return WH.staticUrl+"/uploads/screenshots/"+b+"/"+d+a+".jpg"};WH.maxLevel=110;WH.maxSkill=800;WH.convertRatingToPercent=function(a,b,h,g){var c=WH.convertRatingToPercent.RB,d=WH.convertRatingToPercent.LH,e=WH.convertRatingToPercent.LT;if(a<0){a=1}else{if(a>WH.maxLevel){a=WH.maxLevel}}if((b==12||b==13||b==14||b==15)&&a<34){a=34}if((b==28||b==36)&&(g==2||g==6||g==7||g==11)){c[b]/=1.3}if(h<0){h=0}if(e&&e[b]&&(a>=80)&&(a-80<e[b].length)){return h/e[b][a-80]}var f;if(!c||c[b]==null){f=0}else{var j;if(a>80){j=d[a]}else{if(a>70){j=(82/52)*Math.pow((131/63),((a-70)/10))}else{if(a>60){j=(82/(262-3*a))}else{if(a>10){j=((a-8)/52)}else{j=2/52}}}}f=h/c[b]/j}return f};WH.statToRating={11:0,12:1,13:2,14:3,15:4,16:5,17:6,18:7,19:8,20:9,21:10,25:15,26:15,27:15,28:17,29:18,30:19,31:5,32:8,34:15,35:15,36:17,37:23,44:24,49:25,57:26,59:11,60:12,61:13,62:16,63:20,64:21,40:29};WH.statToJson={0:"mana",1:"health",3:"agi",4:"str",5:"int",6:"spi",7:"sta",8:"energy",9:"rage",10:"focus",13:"dodgertng",14:"parryrtng",16:"mlehitrtng",17:"rgdhitrtng",18:"splhitrtng",19:"mlecritstrkrtng",20:"rgdcritstrkrtng",21:"splcritstrkrtng",22:"_mlehitrtng",23:"_rgdhitrtng",24:"_splhitrtng",25:"_mlecritstrkrtng",26:"_rgdcritstrkrtng",27:"_splcritstrkrtng",28:"mlehastertng",29:"rgdhastertng",30:"splhastertng",31:"hitrtng",32:"critstrkrtng",33:"_hitrtng",34:"_critstrkrtng",35:"resirtng",36:"hastertng",37:"exprtng",38:"atkpwr",39:"rgdatkpwr",40:"versatility",41:"splheal",42:"spldmg",43:"manargn",44:"armorpenrtng",45:"splpwr",46:"healthrgn",47:"splpen",49:"mastrtng",50:"armorbonus",51:"firres",52:"frores",53:"holres",54:"shares",55:"natres",56:"arcres",57:"pvppower",58:"amplify",59:"multistrike",60:"readiness",61:"speedbonus",62:"lifesteal",63:"avoidance",64:"sturdiness",66:"cleave",71:"agistrint",72:"agistr",73:"agiint",74:"strint"};WH.jsonToStat={};for(var i in WH.statToJson){WH.jsonToStat[WH.statToJson[i]]=i}WH.individualToGlobalStat={16:31,17:31,18:31,19:32,20:32,21:32,22:33,23:33,24:33,25:34,26:34,27:34,28:36,29:36,30:36};WH.convertScalingFactor=function(b,g,f,d,j){var a=WH.convertScalingFactor.SV;var c=WH.convertScalingFactor.SD;if(!a||!a[b]){if(g_user.roles&U_GROUP_ADMIN){alert("There are no item scaling values for level "+b)}return(j?{}:0)}var k={},h=a[b],e=c[f];if(!e||!(d>=0&&d<=9)){k.v=h[g]}else{k.n=WH.statToJson[e[d]];k.s=e[d];k.v=Math.floor(h[g]*e[d+10]/10000)}return(j?k:k.v)};g_itemScalingCallbacks=[];if(!WH.wowheadRemote){WH.ajaxIshRequest("/data=item-scaling")}WH.convertScalingSpell=function(b,f,k){var n={},a=WH.convertScalingSpell.SV,c=WH.convertScalingSpell.SD,g,j;if(!c||!c[f]){if(g_user.roles&U_GROUP_ADMIN){alert("There are no spell scaling distributions for dist "+f)}return n}if(!a[b]){if(g_user.roles&U_GROUP_ADMIN){alert("There are no spell scaling values for level "+b)}return n}g=c[f];if(!g[3]){if(g_user.roles&U_GROUP_ADMIN){alert("This spell should not scale at all")}return n}else{if(g[3]==-1){if(g_user.roles&U_GROUP_ADMIN){alert("This spell should use the generic scaling distribution 12")}g[3]=12}}if(!a[b][g[3]-1]){if(g_user.roles&U_GROUP_ADMIN){alert("Unknown category for spell scaling "+g[3])}return n}if(g[15]>0&&g[15]<b){b=g[15]}j=a[b][g[3]-1];if(g[13]){j*=(Math.min(b,g[14])+(g[13]*Math.max(0,b-g[14])))/b}n.cast=Math.min(g[1],g[1]>0&&b>1?g[0]+(((b-1)*(g[1]-g[0]))/(g[2]-1)):g[0]);n.effects={};for(var d=0;d<3;++d){var l=g[4+d],h=g[7+d],e=g[10+d],m=n.effects[d+1]={};if(k&&k.hasOwnProperty(d)){l=k[d].damage||l;h=k[d].range||h;e=k[d].combo||e}m.avg=l*j*(g[1]>0?n.cast/g[1]:1);m.min=Math.round(m.avg)-Math.floor(m.avg*h/2);m.max=Math.round(m.avg)+Math.floor(m.avg*h/2);m.pts=Math.round(e*j);m.avg=Math.max(Math.ceil(l),Math.round(m.avg))}n.cast=Math.round(n.cast/10)/100;return n};if(!WH.wowheadRemote){WH.ajaxIshRequest("/data=spell-scaling")}WH.getDataSource=function(){if(WH.isSet("g_pageInfo")){switch(g_pageInfo.type){case 3:if(WH.isSet("g_items")){return g_items}break;case 6:if(WH.isSet("g_spells")){return g_spells}break;case 200:if(WH.isSet("g_petabilities")){return g_petabilities}break}}return[]};WH.setJsonItemLevel=function(s,b,h){if(h&&((h.scalingcategory-11)>0)){var u=h.maxlvlscaling?Math.min(b,h.maxlvlscaling):b;var g=WH.getSpellScalingValue(h.scalingcategory,u);for(var q=1;q<3;++q){var a=h["itemenchspell"+q];var l=h["itemenchtype"+q];var m=WH.statToJson[a];if((l==5)&&s[m]){var j=h["damage"+q];if(j){s[m]=Math.round(g*j)}}}if(h.allstats){for(var t in s){s[t]=Math.round(g*h.damage1)}}}if(!s.scadist||!s.scaflags){return}s.bonuses=s.bonuses||{};var k=s.scaflags&255,d=(s.scaflags>>8)&255,n=(s.scaflags&(1<<16))!=0,f=(s.scaflags&(1<<17))!=0,o=(s.scaflags&(1<<18))!=0,p;switch(k){case 5:case 1:case 7:case 17:p=7;break;case 3:case 12:p=8;break;case 16:case 11:case 14:p=9;break;case 15:p=10;break;case 23:case 21:case 22:case 13:p=11;break;default:p=-1}if(p>=0){for(var q=0;q<10;++q){var e=WH.convertScalingFactor(b,p,s.scadist,q,1);if(e.n){s[e.n]=e.v}s.bonuses[e.s]=e.v}}if(o){s.splpwr=s.bonuses[45]=WH.convertScalingFactor(b,6)}if(n){switch(k){case 3:s.armor=WH.convertScalingFactor(b,11+d);break;case 5:s.armor=WH.convertScalingFactor(b,15+d);break;case 1:s.armor=WH.convertScalingFactor(b,19+d);break;case 7:s.armor=WH.convertScalingFactor(b,23+d);break;case 16:s.armor=WH.convertScalingFactor(b,28);break;case 14:s.armor=WH.convertScalingFactor(b,29);break;default:s.armor=0}}if(f){var c=(s.mledps?"mle":"rgd"),r;switch(k){case 23:case 21:case 22:case 13:s.dps=s[c+"dps"]=WH.convertScalingFactor(b,o?2:0);r=0.3;break;case 17:s.dps=s[c+"dps"]=WH.convertScalingFactor(b,o?3:1);r=0.2;break;case 15:s.dps=s[c+"dps"]=WH.convertScalingFactor(b,d==19?5:4);r=0.3;break;default:s.dps=s[c+"dps"]=0;r=0}s.dmgmin=s[c+"dmgmin"]=Math.floor(s.dps*s.speed*(1-r));s.dmgmax=s[c+"dmgmax"]=Math.floor(s.dps*s.speed*(1+r))}};WH.setJsonSpellLevel=function(a,c,b){if(!a.scadist){return}WH.cO(a,WH.convertScalingSpell(c,a.scadist,b))};WH.scaleItemEnchantment=function(h,b){var f=h.enchantment;if(h.scalinginfo&&(h.scalinginfo.scalingcategory-11)>0){var e=f.match(/\d+/g);if(e){var g=parseInt(h.scalinginfo.maxlvlscaling)?Math.min(b,parseInt(h.scalinginfo.maxlvlscaling)):b;var a=WH.getSpellScalingValue(h.scalinginfo.scalingcategory,g);for(var c=0;c<e.length;++c){var d=h.scalinginfo["damage"+(c+1)];if(d){f=f.replace(e[c],Math.round(a*d))}}}}return f};WH.getItemRandPropPointsType=function(a){var b=a.slotbak?a.slotbak:a.slot;switch(b){case 1:case 4:case 5:case 7:case 15:case 17:case 20:case 25:return 0;case 26:if(a.subclass==19){return 3}return 0;case 13:case 21:case 22:return 3;case 3:case 6:case 8:case 10:case 12:return 1;case 2:case 9:case 11:case 14:case 16:case 23:return 2;case 28:return 4;default:return -1}};WH.scaleItemLevel=function(m,o){var c=m.level;if(m.scadist){var f=WH.convertScalingFactor.SD;var s=WH.curvePoints;var b=f?f[m.scadist]:null;if(s&&b&&b[22]&&b[22]>0){var u=b[22];var t=o?o:WH.maxLevel;if(b[20]&&t<b[20]){t=b[20]}if(b[21]&&t>b[21]){t=b[21]}var h=s[u];if(h&&h.length>0){var p=-1;for(var e in h){var q=h[e];if(q[1]>=t){p=e;break}}var a=h[p!=-1?p:(h.length-1)];var d=null;var k=0;if(p>0){d=h[p-1];var r=a[1]-d[1];if(r>0){var l=t-d[1];var n=l/r;var j=a[2]-d[2];var g=n*j;k=d[2]+g}}else{k=a[2]}if(k>0){c=Math.round(k)}}}}return c};WH.applyStatModifications=function(Y,q,N,w,ab,k,E){if(!Y.quality&&Y.name&&Y.name.length&&parseInt(Y.name[0])){Y.quality=8-parseInt(Y.name[0])}var a={};if(Y.hasOwnProperty("level")){a=WH.dO(Y)}else{WH.cOr(a,Y,"__")}if(ab&&ab.length){var C=false;for(var V=0;V<ab.length;++V){var r=ab[V];if(r>0&&WH.isSet("g_itembonuses")&&g_itembonuses[r]){var F=g_itembonuses[r];for(var U=0;U<F.length;++U){var x=F[U];switch(x[0]){case 11:case 13:if(C===false||x[2]<C){a.scadist=x[1];a.scadistbonus=r;C=x[2]}break;default:break}}}}}a.level=WH.scaleItemLevel(a,k);if(N=="pvp"&&Y.pvpUpgrade){a.level+=Y.pvpUpgrade}if(a.subitems&&a.subitems[q]){for(var ac in a.subitems[q].jsonequip){if(!a.hasOwnProperty(ac)){a[ac]=0}a[ac]+=a.subitems[q].jsonequip[ac]}}if(ab&&ab.length){if(Y.statsInfo){a.statsInfo={};for(var V in Y.statsInfo){a.statsInfo[V]={alloc:parseInt(Y.statsInfo[V].alloc),qty:Y.statsInfo[V].qty,socketMult:Y.statsInfo[V].socketMult}}}var B=[0,0,0,0,2147483647,2147483647,2147483647,2147483647];a.extraStats=[];var m=a.scadistbonus?false:0;for(var V=0;V<ab.length;++V){var r=ab[V];if(r>0&&WH.isSet("g_itembonuses")&&g_itembonuses[r]){var F=g_itembonuses[r];for(var U=0;U<F.length;++U){var x=F[U];switch(x[0]){case 1:if(!a.scadistbonus){a.level+=x[1];m=false}break;case 2:if(a.statsInfo){if(a.statsInfo.hasOwnProperty(x[1])){a.statsInfo[x[1]].alloc+=x[2]}else{a.extraStats.push(x[1]);a.statsInfo[x[1]]={alloc:parseInt(x[2]),qty:0,socketMult:0}}}break;case 3:a.name=(8-parseInt(x[1]))+(a.name?a.name.substr(1):"");a.quality=parseInt(x[1]);break;case 4:var f=x[1];var b=x[2];var R=4;var Q=4;do{if(b<=B[R]){var v=f;f=B[R-4];B[R-4]=v;var P=b;b=B[R];B[R]=P}++R;--Q}while(Q);break;case 5:if(WH.isSet("g_item_namedescriptions")&&g_item_namedescriptions[x[1]]){a.nameSuffix=g_item_namedescriptions[x[1]][0]}break;case 6:var J=a.nsockets?a.nsockets:0;a.nsockets=J+x[1];for(var S=J;S<(J+x[1]);++S){a["socket"+(S+1)]=x[2]}break;case 7:break;case 8:a.reqlevel+=x[1];break;case 14:if(m!==false){m=Math.max(m,x[1])}break;default:break}}}}if(m){a.level=m;a.previewLevel=m}if(WH.isSet("g_item_namedescriptions")){a.namedesc=a.namedesc?a.namedesc:"";for(var U=0;U<4;++U){if(B[U]&&g_item_namedescriptions[B[U]]){a.namedesc+=(!a.namedesc?"":" ")+g_item_namedescriptions[B[U]][0];if(!U){a.namedesccolor=g_item_namedescriptions[B[U]][1]}}}}}if(Y.statsInfo&&Y.level&&WH.applyStatModifications.ScalingData){var X=WH.applyStatModifications.ScalingData.AV,p=WH.applyStatModifications.ScalingData.SV,A=WH.applyStatModifications.ScalingData.AL;a.level=w?w:(N&&Y.upgrades&&Y.upgrades[N-1]?(a.level+Y.upgrades[N-1]):a.level);var u=a.level-Y.level;var L=Math.pow(1.15,u/15);var H=WH.getItemRandPropPointsType(a);var O=[];for(var W=a.level;W>=0;W--){if(p.hasOwnProperty(W)){O=p[W];break}}var t=0;if(H!=-1){var M=0;switch(a.quality){case 5:case 4:M=0;break;case 7:case 3:M=1;break;case 2:M=2;break;default:break}var s=M*5+H;t=O[s]?O[s]:0}var K=p[W][15];for(var V in WH.statToJson){var h=WH.statToJson[V];if(a[h]||(a.statsInfo&&a.statsInfo[V])){var o=0;var aa=0;if(a.statsInfo.hasOwnProperty(V)){o=parseFloat(a.statsInfo[V].socketMult);aa=parseInt(a.statsInfo[V].alloc)}var z=Math.round(o*K);if(aa&&t>0){a[h]=Math.round((aa/10000)*t)-z}else{a[h]=Math.floor(((a[h]+z)*L)-z)}if(E&&WH.inArray(WH.applyStatModifications.BASE_STATS,V)<0){a[h]=Math.floor(a[h]*WH.getCombatRatingMult(a.level,a.slot||g_items[a.id].slot))}switch(h){case"agistrint":a.agi=a.str=a["int"]=a[h];break;case"agistr":a.agi=a.str=a[h];break;case"agiint":a.agi=a["int"]=a[h];break;case"strint":a.str=a["int"]=a[h];break;default:break}}}if(a.armor&&X[a.level]){var D=(a.quality==7)?3:a.quality;var c=(a.subclass==-6)?1:a.subclass;if(WH.inArray([1,2,3,4],c)!=-1){var Z=X[a.level][11+D];var I=X[a.level][c-1];var g=A[a.slot][c-1];a.armor=Math.floor(I*Z*g+0.5)}if(a.subclass==6){a.armor=X[a.level][4+D]}}if(a.dps){var e=["dps","mledps","rgddps"];var T=["dmgmin1","mledmgmin","rgddmgmin","dmgmax1","mledmgmax","rgddmgmax"];var G=0,l=0,y=0;var d=WH.getEffectiveWeaponDamage(a.level,a.classs,a.subclass,a.quality,a.speed*1000,a.dmgrange,a.slotbak?a.slotbak:a.slot,a.flags2,false);l=Math.floor(d);y=WH.getEffectiveWeaponDamage(a.level,a.classs,a.subclass,a.quality,a.speed*1000,a.dmgrange,a.slotbak?a.slotbak:a.slot,a.flags2,true);G=((d+y)/2)/a.speed;for(var V in e){if(a[e[V]]){a[e[V]]=parseFloat(G.toFixed(2))}}for(var V in T){if(a[T[V]]){if(T[V].indexOf("max")!=-1){a[T[V]]=y}else{a[T[V]]=l}}}}}return a};WH.applyStatModifications.BASE_STATS=[4,3,5,71,72,73,74,7,1,0,8,9,2,10];WH.applyStatModifications.ITEM_TIMEWALKINGMODE_TBC_LEVEL=95;WH.applyStatModifications.ITEM_TIMEWALKINGMODE_WOTLK_LEVEL=160;WH.applyStatModifications.ITEM_TIMEWALKINGMODE_CATA_LEVEL=300;WH.applyStatModifications.ITEM_TIMEWALKINGMODE_MISTS_LEVEL=463;WH.getItemDamageValue=function(c,e,a){var b=WH.applyStatModifications.ScalingData.DV;var d=7*a+e;if(b&&b[c]&&b[c][d]){return b[c][d]}return 0};WH.getEffectiveWeaponDamage=function(e,g,d,l,c,f,a,k,h){f=f?f:0;var n=0;var j=0;var m=false;var b=(k&512);if(g!=2){return 0}if(l>7){return 0}if(l==7){l=3}if(a>22){if(a==24){j=0;m=true}if(!m&&(a<=24||a>26)){m=true}}else{if(a==21||a==22||a==13){if(!b){j=WH.getItemDamageValue(e,l,0)}else{j=WH.getItemDamageValue(e,l,1)}m=true}if(!m&&a!=15){if(a!=17){m=true}else{if(!b){j=WH.getItemDamageValue(e,l,2)}else{j=WH.getItemDamageValue(e,l,3)}m=true}}}if(!m&&d>=2){if(d==2||d==3||d==18){if(!b){j=WH.getItemDamageValue(e,l,2)}else{j=WH.getItemDamageValue(e,l,3)}m=true}if(!m&&d==19){j=WH.getItemDamageValue(e,l,1)}}if(j>0){if(!h){n=j*(c/1000)*(1-f/2)}else{n=Math.floor((j*(c/1000)*(1+f/2))+0.5)}}return n};WH.getJsonReforge=function(c,a){if(!a){if(!WH.reforgeStats){return[]}c.__reforge={};c.__reforge.all=[];for(var a in WH.reforgeStats){var d=WH.getJsonReforge(c,a);if(d.amount){c.__reforge.all.push(d)}}return c.__reforge.all}if(!WH.reforgeStats||!WH.reforgeStats[a]){return{}}c.__statidx={};for(var b in c){if(WH.individualToGlobalStat[WH.jsonToStat[b]]){c.__statidx[WH.individualToGlobalStat[WH.jsonToStat[b]]]=c[b]}else{c.__statidx[WH.jsonToStat[b]]=c[b]}}if(!c.__reforge){c.__reforge={}}var d=c.__reforge[a]=WH.dO(WH.reforgeStats[a]);c.__reforge[a].amount=Math.floor(d.v*(c.__statidx[d.i1]&&!c.__statidx[d.i2]?c.__statidx[d.i1]:0));return c.__reforge[a]};WH.getJsonItemEnchantMask=function(a){if(a.classs==2&&a.subclass==19){return 1<<(21-1)}return 1<<(a.slot-1)};WH.getArtifactKnowledgeMultiplier=function(d){var c=1;for(var b=0,a;a=WH.data.artifactKnowledgeMultiplier[b];b++){if(b>d){break}c=a}return c};WH.getCurveValue=function(c,b){var d;if(!WH.curvePoints||!(d=WH.curvePoints[c])){return undefined}var f=d[0][1];var e=d[0][2];if(f>b){return e}for(var g=0,a;a=d[g];g++){if(b==a[1]){return a[2]}if(b<a[1]){return(a[2]-e)/(a[1]-f)*(b-f)+e}f=a[1];e=a[2]}return e};WH.setItemModifications=function(E,u,U,K,g,v){if(!WH.isSet("g_items")||!g_items[u]||!g_items[u].jsonequip){return E}U=U?U.split(":"):null;var D=g_items[u].bonusesData;var z=0;var q=U?U.indexOf("u"):-1;if(D&&q!=-1){z=U[q+1];U.splice(q,1)}if(!v){v=0;switch(K){case"twtbc":v=WH.applyStatModifications.ITEM_TIMEWALKINGMODE_TBC_LEVEL;break;case"twwotlk":v=WH.applyStatModifications.ITEM_TIMEWALKINGMODE_WOTLK_LEVEL;break;case"twcata":v=WH.applyStatModifications.ITEM_TIMEWALKINGMODE_CATA_LEVEL;break;case"twmists":v=WH.applyStatModifications.ITEM_TIMEWALKINGMODE_MISTS_LEVEL;break}}K=!v?K:null;var O=WH.applyStatModifications(g_items[u].jsonequip,0,K,v,U,g);if(!O.name&&g_items[u].hasOwnProperty("name_"+Locale.getName())){O.name=""+(8-g_items[u].quality)+g_items[u]["name_"+Locale.getName()]}if(z){var o=WH.bonusesBtnGetContextBonusId(U);var x=D[o].sub[z].sub;for(var n in x){var j=WH.applyStatModifications(g_items[u].jsonequip,0,K,v,[o,n]);for(var e in j.statsInfo){var P=j[WH.statToJson[e]];if(O.statsInfo[e]){if(typeof O[WH.statToJson[e]]=="number"||!O[WH.statToJson[e]]){var l=O[WH.statToJson[e]]?O[WH.statToJson[e]]:P;O[WH.statToJson[e]]={};O[WH.statToJson[e]]["min"]=l;O[WH.statToJson[e]]["max"]=l}var b=O[WH.statToJson[e]]["min"];var p=O[WH.statToJson[e]]["max"];if(P<b){O[WH.statToJson[e]]["min"]=P}else{if(P>p){O[WH.statToJson[e]]["max"]=P}}}}}}E=E.replace(/(<!--ilvl-->)\d+\+?/,function(W,X){return X+O.level+(O.previewLevel?"+":"")});var G=false;if(O.scadist){var B=WH.convertScalingFactor.SD;var m=B?B[O.scadist]:null;if(m&&m[21]){G=true;var w=(m[20]?m[20]:1);var C=m[21];g=((g&&g<=C)?g:C);E=E.replace(/(<!--lvl-->)\d+/g,function(W,X){return X+((g&&g<=C)?g:C)});E=E.replace(/(<!--minlvl-->)\d+/,function(W,X){return X+w});E=E.replace(/(<!--maxlvl-->)\d+/,function(W,X){return X+C});var H=false;E=E.replace(/<!--i\?(\d+):(\d+):(\d+):(\d+)(?::(\d+):(\d+))?/,function(aa,ac,Z,W,X,Y,ab){H=true;return"<!--i?"+ac+":"+w+":"+C+":"+g+":"+O.scadist+":"+(ab||0)});if(!H){E+="<!--i?"+u+":"+w+":"+C+":"+g+":"+O.scadist+":0-->"}E=E.replace(/(<!--huindex-->)\d+/,function(Y,Z){var aa=0;if(O.scadistbonus&&O.heirloombonuses){for(var W=0,X;X=O.heirloombonuses[W];W++){if(parseInt(O.scadistbonus)===X){aa=W+1;break}}}return Z+aa});var V=E.match(/<!--\?([0-9-:]*)-->/);if(V){V=V[1].split(":");var R=parseInt(V[4])||0;if(R>0){var a={scadist:R};WH.setJsonSpellLevel(a,g);if(a.effects){E=WH.adjustSpellPoints(E,a)}}}}}else{E=E.replace(/<!--i\?(\d+):(\d+):(\d+):(\d+)(?::(\d+):(\d+))?/,function(aa,ac,Z,W,X,Y,ab){return"<!--i?"+ac+":"+Z+":"+W+":"+(g?g:W)})}var L;if(L=WH.ge("sl"+u)){L.style.display=G?"":"none"}E=E.replace(/(<!--pvpilvl-->)\d+/,function(W,X){return X+(O.level+((K!="pvp")?O.pvpUpgrade:0))});E=E.replace(/(<!--ilvldelta-->)\d+/,function(X,Y){var W=1718;var Z=Math.floor(WH.getCurveValue(W,O.level)||2);return Y+Z});E=E.replace(/(<!--rlvl-->)\d+/,function(W,X){return X+O.reqlevel});E=E.replace(/(<!--uindex-->)\d+/,function(W,X){return(K&&K!="pvp")?(X+K):W});var c=(typeof O.dmgrange!="undefined")&&O.dmgrange;var f=new RegExp("(<!--dmg-->)\\d+"+(c?"(\\D*?)\\d+":"")+"");E=E.replace(f,function(X,Y,W){return Y+O.dmgmin1+(c?(W+O.dmgmax1):"")});E=E.replace(/(<!--dps-->\D*?)(\d+\.\d+)/,function(W,X){return X+(O.dps?O.dps.toFixed(2):"0")});E=E.replace(/(<!--amr-->)\d+/,function(W,X){return X+O.armor});E=E.replace(/<span><!--stat(\d+)-->[-+][\d\.,]+(\D*?)<\/span>(<!--e-->)?(<!--ps-->)?(<br ?\/?>)?/gi,function(X,aa,Z,ac,W,af){var Y,ae=(O[WH.statToJson[aa]]?O[WH.statToJson[aa]]:0);if(ae){var ab=z&&ae.min?ae.min:ae;var ad=z&&ae.max?ae.max:ae;ae=(ab>0?"+":"-")+WH.numberLocaleFormat(ab!=ad?(ab+"-"+ad):ab);Y="";af=(af?"<br />":"")}else{ae="+0";Y=' style="display: none"';af=(af?"<!--br-->":"")}return"<span"+Y+"><!--stat"+aa+"-->"+ae+Z+"</span>"+(ac||"")+(W||"")+af});var y=WH.getCombatRatingMult(O.level,g_items[u].slot);E=E.replace(/<span class="q2">((?:<!--stat\d+-->)?.*?[-+])<!--rtg(\d+)-->[\d\.,]+(.*?)<\/span>(<br \/>)?/gi,function(W,aa,Y,ad,ae){var X,ac=(O[WH.statToJson[Y]]?O[WH.statToJson[Y]]:0);if(ac){var Z=Math.floor((z&&ac.min?ac.min:ac)*y);var ab=Math.floor((z&&ac.max?ac.max:ac)*y);ac=WH.numberLocaleFormat(Z!=ab?(Z+"-"+ab):Z);X="";ae=(ae?"<br />":"")}else{X=' style="display: none"';ae=(ae?"<!--br-->":"")}return'<span class="q2"'+X+">"+aa+"<!--rtg"+Y+"-->"+ac+ad+"</span>"+ae});if(O.extraStats&&O.extraStats.length){E=E.replace(/<!--re--><span[^<]*?<\/span>(<br \/>)?/,"");var t=WH.applyStatModifications.BASE_STATS;E=E.replace(/<!--ebstats-->/,function(ae){var Z="";for(var Y=0;Y<O.extraStats.length;++Y){var W=O.extraStats[Y];if(t.indexOf(W)==-1){continue}var ab="$1$2 "+(WH.statToJson&&WH.statToJson[W]&&LANG.traits[WH.statToJson[W]]?LANG.traits[WH.statToJson[W]][1]:"Unknown");var aa=WH.statToJson&&WH.statToJson[W]?O[WH.statToJson[W]]:0;var X=Math.floor((z&&aa.min?aa.min:aa)*y);var ac=Math.floor((z&&aa.max?aa.max:aa)*y);var ad=WH.numberLocaleFormat(X!=ac?(X+"-"+ac):X);Z+="<br /><span><!--stat"+W+"-->"+WH.sprintf(ab,(X<0)?"-":"+",ad)+"</span>"}return Z+ae});E=E.replace(/<!--egstats-->/,function(af){var Z="";for(var Y=0;Y<O.extraStats.length;++Y){var W=O.extraStats[Y];if(t.indexOf(W)!=-1){continue}var ac="$1$2 "+(WH.statToJson&&WH.statToJson[W]&&LANG.traits[WH.statToJson[W]]?LANG.traits[WH.statToJson[W]][1]:"Unknown");var ab=WH.statToJson&&WH.statToJson[W]?O[WH.statToJson[W]]:0;var X=Math.floor((z&&ab.min?ab.min:ab)*y);var ad=Math.floor((z&&ab.max?ab.max:ab)*y);var ae=WH.numberLocaleFormat(X!=ad?(X+"-"+ad):X);var aa=WH.sprintf("<!--rtg$1-->$2",W,ae);var ag="";if(WH.statToRating&&WH.statToRating[W]){ag=WH.sprintf("&nbsp;<small>(<!--rtg%$1-->0&nbsp;@&nbsp;L$2"+WH.maxLevel+")</small>",W,z?"":"<!--lvl-->")}var ah="";if(W==50){ah="<!--stat%d-->"}if(W==64){ac=ac.substr(5);ag=""}Z+='<br /><span class="q2">'+ah+WH.sprintf(ac,(X>=0)?"+":"-",aa)+ag+"</span>"}return Z+af})}E=E.replace(/(<!--nstart-->)(.*)(<!--nend-->)/,function(aa,X,Y,W){var ac=8-parseInt(O.name.substr(0,1));var Z=O.name.substr(1);var ab=O.nameSuffix?(" "+O.nameSuffix):"";return X+WH.sprintf('<b class="q$1">$2</b>',ac,Z+ab)+W});E=E.replace(/(<!--ndstart-->)(.*)(<!--ndend-->)/,function(Z,X,W,aa){if(!O.namedesc){return X+aa}if(!O.namedesccolor){return Z}var Y=parseInt(O.namedesccolor).toString(16);while(Y.length<6){Y="0"+Y}return X+WH.sprintf('<br /><span style="color: $1">$2</span>',"#"+Y,O.namedesc)+aa});var J=g_items[u].jsonequip.nsockets|0;if((!J&&O.nsockets)||(J&&O.nsockets>J)){E=E.replace(/<!--ps-->(<br(?: \/)?>)?/,function(ac,ae){var Z="";for(var X=J;X<O.nsockets;++X){if(!O["socket"+(X+1)]){continue}var aa=O["socket"+(X+1)];var Y="socket-unknown";var W=81;var ab=aa;switch(aa){case 1:Y="socket-meta";W=81;ab=1;break;case 2:Y="socket-red";W=81;ab=2;break;case 3:Y="socket-yellow";W=81;ab=3;break;case 4:Y="socket-blue";W=81;ab=4;break;case 5:Y="socket-hydraulic";W=81;ab=5;break;case 6:Y="socket-cogwheel";W=81;ab=6;break;case 7:Y="socket-prismatic";W=81;ab=9;break;case 8:Y="socket-relic-iron";W=225;ab=64;break;case 9:Y="socket-relic-blood";W=225;ab=128;break;case 10:Y="socket-relic-shadow";W=225;ab=256;break;case 11:Y="socket-relic-fel";W=225;ab=512;break;case 12:Y="socket-relic-arcane";W=225;ab=1024;break;case 13:Y="socket-relic-frost";W=225;ab=2048;break;case 14:Y="socket-relic-fire";W=225;ab=4096;break;case 15:Y="socket-relic-water";W=225;ab=8192;break;case 16:Y="socket-relic-life";W=225;ab=16384;break;case 17:Y="socket-relic-storm";W=225;ab=32768;break;case 18:Y="socket-relic-holy";W=225;ab=65536;break;default:break}var ad=WH.sprintf('<a href="/items/gems?filter=$1;$2;0" class="$3 q0">',W,ab,Y);ad+=g_socket_names[aa]?g_socket_names[aa]:(g_gem_types[aa]?WH.sprintf(LANG.tooltip_emptyrelicslot.replace("%s","$1"),g_gem_types[aa]):"Unknown Socket");ad+="</a>";Z+="<br>"+ad}return(J==0?"<br>":"")+Z+"<br><br>"})}if(WH.applyStatModifications&&WH.applyStatModifications.ScalingData){var h;var d=/(<!--pts(\d):(\d):(\d+(?:\.\d+)?):(\d+):(\d+(?:\.\d+)?)(:crm)?-->(?:<!--rtg\d+-->)?)(\d+(?:\.\d+)?)(<!---->(%?))?/g;while((h=d.exec(E))!==null){var T=parseFloat(h[6]);var k=WH.applyStatModifications.ScalingData.SV;var M=[];for(var S=O.level;S>=0;S--){if(k.hasOwnProperty(S)){M=k[S];break}}var I=0;var A=O.quality;var Q=1;if(h[7]==":crm"){A=3;Q=y}switch(A){case 5:case 4:case 7:case 3:I=1;break;case 2:I=2;break;default:break}var s=I*5;var r=M[s]?M[s]:0;var N=(T*r*Q).toFixed((h[10]=="%")?2:0);E=E.replace(h[0],h[1]+N+(h[9]?h[9]:""))}}var F=0;switch(v){case WH.applyStatModifications.ITEM_TIMEWALKINGMODE_TBC_LEVEL:F=70;break;case WH.applyStatModifications.ITEM_TIMEWALKINGMODE_WOTLK_LEVEL:F=80;break;case WH.applyStatModifications.ITEM_TIMEWALKINGMODE_CATA_LEVEL:F=85;break;case WH.applyStatModifications.ITEM_TIMEWALKINGMODE_MISTS_LEVEL:F=90;break;default:break}if(F){E=E.replace(/<!--ee(\d+):(\d+):(\d+):(\d+):(\d+):(\d+)-->([^<]*)<\/span>/gi,function(W,af,X,Y,ae,ac,aa,ab){var ad={enchantment:ab,scalinginfo:{scalingcategory:af,minlvlscaling:X,maxlvlscaling:Y,damage1:ae/1000,damage2:ac/1000,damage3:aa/1000}};var Z=WH.scaleItemEnchantment(ad,F);return"<!--ee-->"+Z+"</span>"})}E=E.replace(/(<!--rtg%(\d+)-->)([\.,0-9]+)%?/g,function(Y,aa,Z,X){V=E.match(new RegExp("<!--rtg"+Z+"-->([\\d\\.,]+)(-[\\d\\.,]+)?"));if(!V){return Y}if(V[2]){V[2]=V[2].replace(/\D/,"")}V[1]=V[1].replace(/\D/,"");var W=V[2]?((Math.abs(parseInt(V[2]))+parseInt(V[1]))/2):V[1];return aa+(V[2]?"~":"")+(Math.round(WH.convertRatingToPercent(g?g:WH.maxLevel,Z,W)*100)/100)+(Z!=49?"%":"")});return E};WH.setTooltipLevel=function(e,b,r){var t=typeof e;if(t=="number"){var a=WH.getDataSource();if(a[e]&&a[e][(r?"buff_":"tooltip_")+Locale.getName()]){e=a[e][(r?"buff_":"tooltip_")+Locale.getName()]}else{return e}}else{if(t!="string"){return e}}e=e.replace(/<!--(gem|ee)(\d+):(\d+):(\d+):(\d+):(\d+):(\d+)-->([^<]*)<\/span>/gi,function(j,E,D,v,w,C,A,y,z){var B={enchantment:z,scalinginfo:{scalingcategory:D,minlvlscaling:v,maxlvlscaling:w,damage1:C/1000,damage2:A/1000,damage3:y/1000}};var x=WH.scaleItemEnchantment(B,b);return"<!--"+E+"-->"+x+"</span>"});t=e.match(/<!--i?\?([0-9-:]*)-->/);if(!t){return e}t=t[1].split(":");var b=Math.min(parseInt(t[2]),Math.max(parseInt(t[1]),b)),s=parseInt(t[4])||0;if(s){if(!e.match(/<!--pts\d:\d:\d+(?:\.\d+)?:\d+-->/g)&&!(s<0)){e=WH.setItemModifications(e,parseInt(t[0]),null,null,b);WH.updateItemStringLink.call(this)}else{if(s>0){if(!parseInt(t[7])&&WH.isSet("g_pageInfo")&&g_pageInfo.type==3&&g_items[g_pageInfo.typeId]&&g_items[g_pageInfo.typeId].quality!=7){b=Math.min(g_items[g_pageInfo.typeId].reqlevel,b)}var h={};if(g_pageInfo.type==6){h=(g_spells[g_pageInfo.typeId]&&g_spells[g_pageInfo.typeId].effectScaling)||{}}var q={scadist:s};WH.setJsonSpellLevel(q,b,h);e=e.replace(/<!--cast-->\d+\.\d+/,"<!--cast-->"+q.cast);var g;var d=/<!--\?\+\+(\d+):(\d+)-->/g;while((g=d.exec(e))!==null){var c=parseInt(g[1]);var l=parseInt(g[2]);var h=(g_spells[c]&&g_spells[c].effectScaling)||{};q[c]={scadist:l};WH.setJsonSpellLevel(q[c],b,h)}if(q.effects){e=WH.adjustSpellPoints(e,q);if(this.modified){for(var k in this.modified[1]){var u=this.modified[1][k];for(var o=0;o<u.length;++o){u[o][0]=WH.adjustSpellPoints(u[o][0],q);u[o][1]=WH.adjustSpellPoints(u[o][1],q)}}}}}else{var m=-s;var f=WH.getSpellScalingValue(m,b);for(var p=0;p<3;++p){var n=t[5+p]/1000;e=e.replace(new RegExp("<!--gem"+(p+1)+"-->(.+?)<"),"<!--gem"+(p+1)+"-->"+Math.round(f*n)+"<")}}}}e=e.replace(/<!--ppl(\d+):(\d+):(\d+):(\d+)-->\s*\d+/gi,function(w,v,j,x,y){return"<!--ppl"+v+":"+j+":"+x+":"+y+"-->"+Math.round(parseInt(x)+(Math.min(Math.max(b,v),j)-v)*y/100)});e=e.replace(/(<!--rtg%(\d+)-->)([\.0-9]+)%?/g,function(v,x,w,j){t=e.match(new RegExp("<!--rtg"+w+"-->(\\d+)"));if(!t){return v}return x+(Math.round(WH.convertRatingToPercent(b,w,t[1])*100)/100)+(w!=49?"%":"")});e=e.replace(/(<!--i?\?\d+:\d+:\d+:)\d+/g,"$1"+b);e=e.replace(/<!--lvl-->\d+/g,"<!--lvl-->"+b);return e};WH.getSpellScalingValue=function(a,c){var b=WH.convertScalingSpell?WH.convertScalingSpell.SV:null;if(!b){return 0}return b[c][a-1]};WH.adjustSpellPoints=function(c,a){for(var b=1;b<4;++b){c=c.replace(new RegExp("<!--pts"+b+":0:0:(\\d+)-->(<!--rtg\\d+-->)?(.+?)<","g"),function(g,d,e){var f=(a[d]&&a[d].hasOwnProperty("effects"))?a[d].effects[b]:a.effects[b];if(!f){return g}return"<!--pts"+b+":0:0:"+d+"-->"+(e?e:"")+(f.min==f.max?f.avg:f.min+" to "+f.max)+"<"});c=c.replace(new RegExp("<!--pts"+b+":1:0:(\\d+)-->(<!--rtg\\d+-->)?(.+?)<","g"),function(g,d,e){var f=(a[d]&&a[d].hasOwnProperty("effects"))?a[d].effects[b]:a.effects[b];if(!f){return g}return"<!--pts"+b+":1:0:"+d+"-->"+(e?e:"")+f.min+"<"});c=c.replace(new RegExp("<!--pts"+b+":2:0:(\\d+)-->(<!--rtg\\d+-->)?(.+?)<","g"),function(g,d,e){var f=(a[d]&&a[d].hasOwnProperty("effects"))?a[d].effects[b]:a.effects[b];if(!f){return g}return"<!--pts"+b+":2:0:"+d+"-->"+f.max+"<"});c=c.replace(new RegExp("<!--pts"+b+":3:(\\d+(?:\\.\\d+)?):(\\d+)-->(<!--rtg\\d+-->)?(.+?)<","g"),function(h,g,d,e){var f=(a[d]&&a[d].hasOwnProperty("effects"))?a[d].effects[b]:a.effects[b];if(!f){return h}return"<!--pts"+b+":3:"+g+":"+d+"-->"+(e?e:"")+Math.round(f.avg*g)+"<"});c=c.replace(new RegExp("<!--pts"+b+":4:0:(\\d+)-->(<!--rtg\\d+-->)?(.+?)<","g"),function(g,d,e){var f=(a[d]&&a[d].hasOwnProperty("effects"))?a[d].effects[b]:a.effects[b];if(!f){return g}return"<!--pts"+b+":4:0:"+d+"-->"+(e?e:"")+f.pts+"<"})}return c};WH.getCombatRatingMult=function(d,c){var a=0;switch(c){case 2:case 11:a=3;break;case 12:a=2;break;case 13:case 14:case 15:case 17:case 21:case 22:case 23:case 25:case 26:a=1;break}var b=(WH.convertRatingToPercent.hasOwnProperty("RM")&&WH.convertRatingToPercent.RM.hasOwnProperty(d))?WH.convertRatingToPercent.RM[d][a]:1;if(typeof b=="undefined"){b=1}return b};WH.roundArtifactPower=function(b){var a=1;if(b>50){a=5}if(b>1000){a=25}if(b>5000){a=50}return WH.roundHalfEven(b/a)*a};WH.roundHalfEven=function(b){if(Math.floor(b*100000)%100000==50000){var a=Math.floor(b);return a+a%2}return Math.round(b)};WH.setTooltipSpells=function(k,a,l,d){var h={},f="<!--sp([0-9]+):[01]-->.*?<!--sp\\1-->",b;if(a==null){a=[]}if(d==null){d={}}for(var c=0;c<a.length;++c){h[a[c]]=1}if(b=k.match(new RegExp(f,"g"))){for(var c=0;c<b.length;++c){var e=b[c].match(f)[1];h[e]=(h[e]|0);if(d[e]==null){d[e]=-1}d[e]++;if(l[e]==null||l[e][d[e]]==null||l[e][d[e]][h[e]]==null){continue}var j=l[e][d[e]][h[e]];j=WH.setTooltipSpells(j,a,l,d);if(h[e]&&!l[e][d[e]][0]&&(c<(b.length-1))&&(k.indexOf(b[c]+b[c+1])!=-1)){var g=b[c+1].match(f)[1];h[g]=(h[g]|0);k=k.replace(b[c+1],"<!--sp"+g+":"+h[g]+"-->"+j+"<!--sp"+g+"-->");continue}k=k.replace(b[c],"<!--sp"+e+":"+h[e]+"-->"+j+"<!--sp"+e+"-->")}}return k};WH.enhanceTooltip=function(H,G,t,O,q,f,b,M,L,u,d,D,F,E){if((!WH.applyStatModifications||!WH.applyStatModifications.ScalingData)&&(E||M)){g_itemScalingCallbacks.push((function(U){return function(){var V=WH.enhanceTooltip.call(U,H,G,t,O,q,f,b,M,L,u,d,D,F,E);WH.updateTooltip.call(U,V)}})(this));return LANG.tooltip_loading}var T=typeof H,P,I;var s=WH.getDataSource();var l=WH.isSet("g_pageInfo")?g_pageInfo.type:null;I=WH.isSet("g_pageInfo")?g_pageInfo.typeId:null;this._knownSpells=f;if(T=="number"){I=H;var J="tooltip_";if(q){J="buff_"}if(D){J="tooltip_premium_"}if(F){J="text_"}if(s[I]&&s[I][J+Locale.getName()]){H=s[I][J+Locale.getName()];P=s[I][(q?"buff":"")+"spells_"+Locale.getName()];this._rppmModList=s[I]["rppmmod"];if(P){H=WH.setTooltipSpells(H,f,P)}}else{return H}}else{if(T!="string"){return H}}var m;if(t){var Q=WH.getGets();if(Q.lvl){H=WH.setTooltipLevel(H,Q.lvl,q)}m=Q.ilvl}if((E||M)&&I){H=WH.setItemModifications(H,I,E,M,this._selectedLevel?this._selectedLevel:null,m)}if(G){H=H.replace(/\(([^\)]*?<!--lvl-->[^\(]*?)\)/gi,function(V,U){return'(<a href="javascript:;" onmousedown="return false" class="tip" style="color: white; cursor: pointer" onclick="WH.staticTooltipLevelClick(this, null, 0)" onmouseover="WH.Tooltip.showAtCursor(event, \'<span class=\\\'q2\\\'>\' + LANG.tooltip_changelevel + \'</span>\')" onmousemove="WH.Tooltip.cursorUpdate(event)" onmouseout="WH.Tooltip.hide()">'+U+"</a>)"});if(H.indexOf("<!--artpow:")>0){if(!this.hasOwnProperty("_knowledgeLevel")){var z=/(&|\?)artk=(\d+)/.exec(location.href);if(z&&parseInt(z[2])<=g_artifact_knowledge_max_level){this._knowledgeLevel=parseInt(z[2])}}var y=this._knowledgeLevel?parseInt(this._knowledgeLevel):0;H=H.replace(/(<!--ndstart-->)?<!--ndend-->/i,function(U,V){return(V?V+"<br />":" ")+'<a href="javascript:;" onmousedown="return false" class="tip" style="color: white; cursor: pointer" onclick="WH.staticTooltipKnowledgeLevelClick(this, null, '+I+')" onmouseover="WH.Tooltip.showAtCursor(event, \'<span class=\\\'q2\\\'>\' + LANG.tooltip_changelevel + \'</span>\')" onmousemove="WH.Tooltip.cursorUpdate(event)" onmouseout="WH.Tooltip.hide()">'+WH.sprintf(LANG.tooltip_knowledgeformat.replace("%d","$1"),y)+"</a>"});H=H.replace(/(<!--artpow:(\d+)-->)[\d\.\,]+/,function(U,W,V){return W+WH.numberLocaleFormat(WH.roundArtifactPower(parseInt(V)*WH.getArtifactKnowledgeMultiplier(y)))})}}if(O&&Slider){var N=WH.groupSizeScalingShouldShow(I);if(q){q.bufftip=this;if(N&&WH.isSet("g_difficulties")&&g_difficulties[N]){H=WH.groupSizeScalingOnChange.call(q,this,g_difficulties[N].maxplayers,1,true)}}else{var e=new RegExp("<!--"+((l&&l==3)?"i":"")+"\\?(\\d+):(\\d+):(\\d+):(\\d+)");var h=H.match(e);if(N&&WH.isSet("g_difficulties")&&g_difficulties[N]){var n=WH.ce("label");n.innerHTML=LANG.tooltip_difficulty+": ";this._difficultyBtn=WH.ce("a");this._difficultyBtn.ttId=I;WH.difficultyBtnBuildMenu.call(this,I);Menu.add(this._difficultyBtn,this._difficultyBtn.menu);$("#dd"+I).append(n).append(this._difficultyBtn);WH.difficultyBtnOnChange.call(this,N);H=WH.groupSizeScalingOnChange.call(this,this,g_difficulties[N].maxplayers,0,true)}else{if(h){if(h[2]!=h[3]){this.slider=Slider.init(O,{minValue:parseInt(h[2]),maxValue:parseInt(h[3]),onMove:WH.tooltipSliderMove.bind(this)});Slider.setValue(this.slider,parseInt(h[4]));this.slider.onmouseover=function(U){WH.Tooltip.showAtCursor(U,LANG.tooltip_changelevel2,0,0,"q2")};this.slider.onmousemove=WH.Tooltip.cursorUpdate;this.slider.onmouseout=WH.Tooltip.hide;this.slider.input.onmouseover=function(U){WH.Tooltip.showAtCursor(U,LANG.tooltip_changelevel,0,0,"q2")};this.slider.input.onmousemove=WH.Tooltip.cursorUpdate;this.slider.input.onmouseout=WH.Tooltip.hide}}}}}if(b){if(q&&q.modified){q.bufftip=this}else{for(var R in P){if(!g_spells[R]||WH.inArray(f,R)!=-1){continue}$(b).append('<input type="checkbox" id="known-'+R+'" />').append('<label for="known-'+R+'"><a rel="spell='+R+"&know="+R+'">'+g_spells[R]["name_"+Locale.getName()]+(g_spells[R]["rank_"+Locale.getName()]?" ("+g_spells[R]["rank_"+Locale.getName()]+")":"")+"</a></label>").append("<br />");$("#known-"+R).change(WH.tooltipSpellsChange.bind(this))}}this.modified=[b,P,f];$(b).toggle(!$(b).is(":empty"))}if(d){var a=H.match(/<!--rppm-->(\d+(?:\.\d+)?)<!--rppm-->/);if(a){var k=$("#rppm"+I);if(this._rppmModList.hasOwnProperty(4)){this._rppmModBase=parseFloat(a[1]);if(k.is(":empty")){this._rppmSpecModList=this._rppmModList[4];this._rppmSpecModList.splice(0,0,{spec:-1,modifiervalue:0,filename:""});k.append(WH.getMajorHeading(LANG.realppmmodifiers,2,3));for(var R in this._rppmSpecModList){var o=Icon.create(this._rppmSpecModList[R]["filename"],0,null);o.style.display="inline-block";o.style.verticalAlign="middle";var j=$('<input name="rppmmod" type="radio" id="rppm-'+R+'" />');j.get(0).checked=(this._rppmSpecModList[R]["spec"]==-1);k.append(j).append(this._rppmSpecModList[R]["spec"]==-1?"":o).append('<label for="rppm-'+R+'"> <a>'+(this._rppmSpecModList[R]["spec"]==-1?LANG.finone:g_chr_specs[this._rppmSpecModList[R]["spec"]])+"</a></label>").append("<br />");var K=this;$("#rppm-"+R).change(function(){WH.tooltipRPPMChange.call(this,K)})}}else{var v=this._rppmModBase;var x=this._rppmSpecModList;H=H.replace(/<!--rppm-->(\[?)(\d+(?:\.\d+)?)([^<]*)<!--rppm-->/,function(U,X,W,V){return"<!--rppm-->"+X+(v*(1+parseFloat(x[$('input[name="rppmmod"]:checked',k).attr("id").match(/\d+$/)[0]].modifiervalue))).toFixed(2)+V+"<!--rppm-->"})}}k.toggle(!(k.is(":empty")));var C="";if(this._rppmModList.hasOwnProperty(1)){C+=" + "+LANG.traits.hastertng[2]}else{if(this._rppmModList.hasOwnProperty(2)){C+=" + "+LANG.traits.critstrkrtng[2]}}if(g_pageInfo.type==6&&this._rppmModList.hasOwnProperty(6)){C+=" + Budget"}if(C.length>0){H=H.replace(/<!--rppm-->\[?(\d+(?:\.\d+)?)([^<]*)<!--rppm-->/,function(U,W,V){return"<!--rppm-->["+W+C+"]"+V+"<!--rppm-->"})}}}if(u){for(R=1;R<=L;++R){$(u).append('<input type="checkbox" id="item-upgrade-'+R+'" />').append('<label for="item-upgrade-'+R+'"><a>'+WH.sprintf(LANG.itemupgrade_format,R)+"</a></label>").append("<br />");$("#item-upgrade-"+R).change(WH.upgradeItemTooltip.bind(this,u,R))}if(s[I]&&s[I].hasOwnProperty("tooltip_"+Locale.getName()+"_pvp")){$(u).append('<input type="checkbox" id="item-upgrade-pvp" />').append('<label for="item-upgrade-pvp"><a>'+LANG.su_menu_pvpmode+"</a></label>").append("<br />");$("#item-upgrade-pvp").change(WH.upgradeItemTooltip.bind(this,u,"pvp"))}if(s[I]&&s[I].hasOwnProperty("tooltip_"+Locale.getName()+"_twtbc")){$(u).append('<input type="checkbox" id="item-upgrade-twtbc" />').append('<label for="item-upgrade-twtbc"><a>'+g_difficulty_names[24]+" "+LANG.su_note_bc+"</a></label>").append("<br />");$("#item-upgrade-twtbc").change(WH.upgradeItemTooltip.bind(this,u,"twtbc"))}if(s[I]&&s[I].hasOwnProperty("tooltip_"+Locale.getName()+"_twwotlk")){$(u).append('<input type="checkbox" id="item-upgrade-twwotlk" />').append('<label for="item-upgrade-twwotlk"><a>'+g_difficulty_names[24]+" "+LANG.su_note_wotlk+"</a></label>").append("<br />");$("#item-upgrade-twwotlk").change(WH.upgradeItemTooltip.bind(this,u,"twwotlk"))}if(s[I]&&s[I].hasOwnProperty("tooltip_"+Locale.getName()+"_twcata")){$(u).append('<input type="checkbox" id="item-upgrade-twcata" />').append('<label for="item-upgrade-twcata"><a>'+g_difficulty_names[24]+" "+LANG.su_note_cata+"</a></label>").append("<br />");$("#item-upgrade-twcata").change(WH.upgradeItemTooltip.bind(this,u,"twcata"))}if(s[I]&&s[I].hasOwnProperty("tooltip_"+Locale.getName()+"_twmists")){$(u).append('<input type="checkbox" id="item-upgrade-twmists" />').append('<label for="item-upgrade-twmists"><a>'+g_difficulty_names[24]+" "+LANG.su_note_mists+"</a></label>").append("<br />");$("#item-upgrade-twmists").change(WH.upgradeItemTooltip.bind(this,u,"twmists"))}$(u).toggle(!$(u).is(":empty"))}if(l==3){var p=$("#cs"+I);if(p&&WH.classSpecBtnShouldShow(H)){if(!this._classSpecBtn){var r=WH.ce("label");r.innerHTML=LANG.tooltip_showingtooltipfor+" ";this._classSpecBtn=WH.ce("a");this._classSpecBtn.ttId=I;WH.classSpecBtnBuildMenu.call(this,s[I].hasOwnProperty("validMenuSpecs")?s[I].validMenuSpecs:false);Menu.add(this._classSpecBtn,this._classSpecBtn.menu);p.append(r).append(this._classSpecBtn).show()}var B=WH.localStorage.get("tooltips_class:spec");B=B?B.split(":"):null;var w=/(&|\?)spec=(\d+)/.exec(location.href);var S,A;if(w){S=w[2];A=WH.getClassFromSpec(S);if(A){B=[A,S]}}if(B&&B.length==2){H=WH.classSpecBtnOnChange.call(this,B[0],B[1],H,true)}else{$(this._classSpecBtn).text(LANG.tooltip_chooseaspec)}}}if(s[I]&&WH.bonusesBtnShouldShow(s[I].bonusesData)){var c=$("#bs"+I);if(c&&!this._bonusesBtn){var g=WH.ce("label");g.innerHTML=LANG.tooltip_itembonuses+": ";this._bonusesBtn=WH.ce("a");this._bonusesBtn.ttId=I;this._bonusesBtn.menu=WH.bonusesBtnBuildMenu.call(this,s[I]);Menu.add(this._bonusesBtn,this._bonusesBtn.menu);$(this._bonusesBtn).text(LANG.selectbonus);c.append(g).append(this._bonusesBtn).show();if(E!==""){WH.bonusesBtnOnChange.call(this,E,true)}}}if(l==3){WH.updateItemStringLink.call(this)}return H};WH.evalPlayerCondition=function(c,h){switch(h.id){case 34116:h.achievementLogic=6;h.achievement_2=6566;break;case 34647:case 34645:h.achievementLogic=65536;h.achievement_0=6566;break;case 34648:h.achievementLogic=65537;h.achievement_1=6566;break;case 33788:case 33790:h.prevquest1=38445;h.prevquest2=37935;break;default:break}if(h.minLevel&&c.level<h.minLevel){return false}if(h.maxLevel&&c.level>h.maxLevel){return false}if(h.raceMask&&!((1<<(c.race-1))&h.raceMask)){return false}if(h.classMask&&!((1<<(c["class"]-1))&h.classMask)){return false}if(typeof h.gender!="undefined"&&h.gender!=-1&&c.gender!=h.gender){return false}if(h.minAvgItemLevel&&c.items&&h.minAvgItemLevel>c.items.averageItemLevel){return false}if(h.maxAvgItemLevel&&c.items&&h.maxAvgItemLevel<c.items.averageItemLevel){return false}if(h.minAvgEquippedItemLevel&&c.items&&h.minAvgEquippedItemLevel>c.items.averageItemLevelEquipped){return false}if(h.maxAvgEquippedItemLevel&&c.items&&h.maxAvgEquippedItemLevel>c.items.averageItemLevelEquipped){return false}if(h.skillID_0&&c.professions){var a={};for(var b in c.professions.primary){a[c.professions.primary[b].id]=parseInt(c.professions.primary[b].rank)}for(var b in c.professions.secondary){a[c.professions.secondary[b].id]=parseInt(c.professions.secondary[b].rank)}if(!WH.evalComplexCondition(h.skillLogic,function(j){return a[h["skillID_"+j]]&&(!h["minSkill_"+j]||a[h["skillID_"+j]]>=h["minSkill_"+j])&&(!h["maxSkill_"+j]||a[h["skillID_"+j]]<=h["maxSkill_"+j])})){return false}}if(h.time_0&&h.time_1){var g=WH.decodeBlizzDate(h.time_0);var f=WH.decodeBlizzDate(h.time_1);if(h.id==34518){g=new Date(g.getTime()-24*3600*1000);f=new Date(g.getTime()-24*3600*1000)}if(g_serverTime<g||g_serverTime>f){return false}}if(h.worldStateExpressionID&&WH.worldStateExpressionToEvent[h.worldStateExpressionID]){if(!WH.isSet("g_events")){return false}var d=g_events[WH.worldStateExpressionToEvent[h.worldStateExpressionID]];if(!d){return false}var e=WH.getEventNextDates(d);if(!e[0]||!e[1]||g_serverTime<e[0]||g_serverTime>e[1]){return false}}if(h.prevquest0&&c.quests){if(!WH.evalComplexCondition(h.prevquestlogic,function(j){return WH.inArray(c.quests,h["prevquest"+j])!=-1})){return 0}}if(h.achievement_0&&c.achievements){if(!WH.evalComplexCondition(h.achievementLogic,function(j){return WH.inArray(c.achievements.achievementsCompleted,h["achievement_"+j])!=-1})){return 0}}return true};WH.worldStateExpressionToEvent={1368:141,2941:321,3555:341,4546:372,6572:404,11286:479,17483:559,17484:562,18046:587,17485:561,17486:563,17499:560,17500:564,17503:565,17567:566};WH.evalComplexCondition=function(a,j){var b=(a>>16)&15;var f=(a>>0)&255;var h=j(0);h=(b&1)?!h:h;var d=0;opLoop:while(d<3){var g=j(d+1);var c=(b>>(d+1))&1;g=c?!g:g;var e=(f>>(d*2))&3;switch(e){case 0:break opLoop;case 1:h=h&&g;break;case 2:h=h||g;break}++d}return h};WH.decodeBlizzDate=function(d){var g=new Date();var e=d&63;var k=(d>>6)&31;var c=(d>>20)&15;var l=(d>>14)&63;var h=(d>>24)&31;g.setMinutes(e==63?0:e,0,0);g.setHours(k==31?0:k);g.setFullYear(1900+(h==31?0:(h+100)),c==15?0:c,l==63?1:(l+1));var b=g.getTime();var a=7*24*3600*1000;var f=0;if(a>0){f=Math.ceil((g_serverTime.getTime()-b)/a)*a}var j=new Date();j.setTime(b+f);return j};WH.getEventNextDates=function(b,e){if(e==null){e=g_serverTime}var g=null;var o=null;if(b.dates[0]==""&&b.startDate){b.dates[0]=b.startDate}var h=b.duration0?b.duration0:0;var f=b.duration1?b.duration1:0;var a=b.filtertype?b.filtertype:0;var p=0;for(var n=0;n<b.dates.length;++n){if(b.dates[n]&&b.dates[n]!=""){++p}}if(p>0){if(p>1){for(var n=0;n<b.dates.length;++n){if(!b.dates[n]||b.dates[n]==""){continue}var d=new Date(b.dates[n]).getTime();var k;if(f){d+=h*3600*1000;k=d+f*3600*1000}else{k=d+h*3600*1000}if(e.getTime()<k||(n==b.dates.length-1)){g=new Date();g.setTime(d);o=new Date();o.setTime(k);break}}}else{if(a==-1){if(b.rec&&b.rec==-2){g=new Date(b.dates[0]);o=new Date();o.setTime(g.getTime()+h*3600*1000)}else{var d=new Date(b.dates[0]);for(var n=0;n<2;++n){var m=new Date(e.getFullYear()+n,d.getMonth(),d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds()).getTime();var j;if(f){m+=h*3600*1000;j=m+f*3600*1000}else{j=m+h*3600*1000}if(e.getTime()<j){g=new Date();g.setTime(m);o=new Date();o.setTime(j);break}}}}else{var d=new Date(b.dates[0]).getTime();if(b.id==301){d-=24*3600*1000}var k=d+h*3600*1000;var c=0;if(f>0){c=f*3600*1000}else{switch(a){case 0:c=7*24*3600*1000;break;default:break}}var l=0;if(c>0){l=Math.ceil((e.getTime()-k)/c)*c}g=new Date();g.setTime(d+l);o=new Date();o.setTime(k+l)}}}return[g,o]};WH.groupSizeScalingShouldShow=function(c){if(WH.isSet("g_difficulties")&&WH.isSet("g_spells")&&g_spells[c]&&g_spells[c].effects&&g_spells[c].effects.length>0){for(var b=0;b<g_spells[c].effects.length;++b){for(var a in g_spells[c].effects[b]){if(g_spells[c].effects[b].hasOwnProperty(a)){return a}}}}return false};WH.groupSizeScalingSliderMove=function(c,b,a){WH.groupSizeScalingOnChange.call(this,this,a.value,0);if(this.bufftip){WH.groupSizeScalingOnChange.call(this,this.bufftip,a.value,1)}WH.Tooltip.hide()};WH.groupSizeScalingOnChange=function(l,c,t,q){while(l.className.indexOf("tooltip")==-1){l=l.parentNode}c=parseInt(c);if(isNaN(c)){return}var a=WH.getDataSource();var d=WH.isSet("g_pageInfo")?g_pageInfo.typeId:null;if(a[d]&&a[d].effects&&a[d].effects.length>0){var j=a[d][(t?"buff_":"tooltip_")+Locale.getName()];var e=this._difficultyBtn.selectedDD;this._difficultyBtn.selectedPlayers=c;var h={effects:{}};var g=false;for(var s=0;s<a[d].effects.length;++s){var m=a[d].effects[s][e]?a[d].effects[s][e]:(a[d].effects[s][14]?a[d].effects[s][14]:(a[d].effects[s][1]?a[d].effects[s][1]:null));if(m){g=true;var u=h.effects[s+1]={};var o=m.basepoints+(m.randompoints!=0?1:0);var r=m.basepoints+m.randompoints;var k=g_difficulties[e];var p=k.minplayers;var f=k.maxplayers;if(p<f&&c>p&&m.groupmod>1){if(f<c){c=f}var b=(c-p)/(f-p);var n=m.groupmod-1;o+=o*n*b;r+=r*n*b}u.avg=Math.round((o+r)/2);u.min=Math.round(o);u.max=Math.round(r)}}if(g){j=WH.adjustSpellPoints(j,h);if(q){return j}WH.updateTooltip.call(l,j)}}};WH.difficultyBtnBuildMenu=function(g){var f=[];var a=g_spells[g];var e={};for(var d=0;d<a.effects.length;++d){for(var c in a.effects[d]){var b=[c,g_difficulty_names[c],WH.difficultyBtnOnChange.bind(this,c)];if(a.effects[d].hasOwnProperty(c)&&!e[c]){f.push(b);e[c]=true}}}this._difficultyBtn.menu=f};WH.difficultyBtnOnChange=function(b){this._difficultyBtn.selectedDD=b;$(this._difficultyBtn).text("");WH.arrayWalk(this._difficultyBtn.menu,function(h){h.checked=false});var g=Menu.findItem(this._difficultyBtn.menu,[b]);g.checked=true;$(this._difficultyBtn).text(g[MENU_IDX_NAME]);var e=this._difficultyBtn.selectedPlayers;var d=g_difficulties[b].minplayers,a=g_difficulties[b].maxplayers,c=g_difficulties[b].maxplayers;if(e){if(e>a){c=a}else{if(e<d){c=d}else{c=e}}}var f=$("#sl"+this._difficultyBtn.ttId);f.html("").hide();this.slider=null;if(d!=a){f.show();this.slider=Slider.init(f.get(0),{minValue:parseInt(d),maxValue:parseInt(a),onMove:WH.groupSizeScalingSliderMove.bind(this)});Slider.setValue(this.slider,parseInt(c));this.slider.onmouseover=function(h){WH.Tooltip.showAtCursor(h,LANG.tooltip_changeplayers2,0,0,"q2")};this.slider.onmousemove=WH.Tooltip.cursorUpdate;this.slider.onmouseout=WH.Tooltip.hide;this.slider.input.onmouseover=function(h){WH.Tooltip.showAtCursor(h,LANG.tooltip_changeplayers,0,0,"q2")};this.slider.input.onmousemove=WH.Tooltip.cursorUpdate;this.slider.input.onmouseout=WH.Tooltip.hide}WH.groupSizeScalingSliderMove.call(this,null,null,{value:c})};WH.classSpecBtnShouldShow=function(c){var b=/<span[^>]*?><!--stat(\d+)-->([-+][\d\.,]+(?:-[\d\.,]+)?\D*?)<\/span>/gi;var a=b.exec(c);while(a!=null){if(g_grayedOutStats.hasOwnProperty(a[1])||(WH.inArray(g_specDependantStats,a[1])!=-1)){return true}a=b.exec(c)}if(c.indexOf("<!--traitspec")>0){return true}return false};WH.classSpecBtnOnChange=function(e,h,j,f){e=parseInt(e);h=parseInt(h);$(this._classSpecBtn).html("");this._classSpecBtn.selectedSpec=h;var a=$("<span></span>");a.text(WH.sprintf(" $1 $2",g_chr_specs[h],g_chr_classes[e]));var b=Menu.findItem(this._classSpecBtn.menu,[e,h]);if(b&&b[MENU_IDX_OPT]&&b[MENU_IDX_OPT].tinyIcon){var d=b[MENU_IDX_OPT].tinyIcon;var g=Icon.create(d,0,null,"javascript:;");g.style.display="inline-block";g.style.verticalAlign="middle";$(this._classSpecBtn).append(g)}$(this._classSpecBtn).append(a);if(!f){WH.localStorage.set("tooltips_class:spec",e+":"+h)}var c=j?j:this.innerHTML;c=c.replace(/<span[^>]*?><!--stat(\d+)-->([-+][\d\.,]+(?:-[\d\.,]+)?)(\D*?)<\/span>/gi,function(q,p,m,l){var o=p==50?' class="q2"':"";if(g_grayedOutStats[p]&&(g_grayedOutStats[p].indexOf(h)!=-1)){o=' style="color:gray"'}if(WH.inArray(g_specDependantStats,p)!=-1){var k=WH.getRealStatIdForSpec(p,g_specPrimaryStatOrders[h],g_specPrimaryStatOrders[h].length);var n=WH.statToJson[k];if(n&&LANG.traits[n]){l=" "+LANG.traits[n][1]}}return"<span"+o+"><!--stat"+p+"-->"+m+l+"</span>"});c=c.replace(/<!--scstart(\d+):(\d+)--><span class="q(\d+)">(<!--asc\d+-->)?(.*?)<\/span><!--scend-->/i,function(p,m,n,l,o,k){l=1;var r=m==2&&(!g_classes_allowed_weapon[e]||WH.inArray(g_classes_allowed_weapon[e],n)==-1);var q=m==4&&(!g_classes_allowed_armor[e]||WH.inArray(g_classes_allowed_armor[e],n)==-1);if(r||q){l=10}return"<!--scstart"+m+":"+n+'--><span class="q'+l+'">'+(o?o:"")+k+"</span><!--scend-->"});c=c.replace(/(<!--traitspecstart:(\d+)(?::(\d+))?-->)[\w\W]*?(<!--traitspecend-->)/g,function(o,n,k,m,l){var p="";if(WH.isSet("g_pageInfo")&&g_pageInfo.hasOwnProperty("typeId")&&g_pageInfo.type==3&&g_items.hasOwnProperty(g_pageInfo.typeId)&&g_items[g_pageInfo.typeId].hasOwnProperty("affectsArtifactPowerTypesData")&&g_items[g_pageInfo.typeId].affectsArtifactPowerTypesData.hasOwnProperty(k)&&g_items[g_pageInfo.typeId].affectsArtifactPowerTypesData[k].hasOwnProperty(h)){p=g_items[g_pageInfo.typeId].affectsArtifactPowerTypesData[k][h]}else{if(m){p='<span style="color: #00FF00">'+WH.sprintf(LANG["tooltip_relicrank"+(m>1?"s":"")+"increase"].replace("%d","$1"),m)+": </span>"+LANG.tooltip_relicminortrait}}return n+p+l});if(window.history){if(location.pathname.indexOf("&spec")!=-1){window.history.replaceState({},"",location.pathname.replace(/&spec=\d+/,"&spec="+h)+location.hash)}else{if(!location.hash){window.history.replaceState({},"",location.pathname+"&spec="+h)}else{window.history.replaceState({},"",location.pathname+"&spec="+h+location.hash)}}}if(j){return c}else{this.innerHTML=c}};WH.classSpecBtnBuildMenu=function(m){var b=[[,LANG.tooltip_chooseaspec]];var o=Menu.findItem(mn_spells,[-12]);b=b.concat($.extend(true,[],o[MENU_IDX_SUB]));for(var h in g_chr_specs_by_class){var e=g_chr_specs_by_class[h];var k=null;for(var n in b){var a=b[n];if(a[MENU_IDX_ID]==h){if(a[MENU_IDX_URL]){a[MENU_IDX_URL]=null}k=n;break}}if(k==null){continue}for(var g in e){var f=b[k][MENU_IDX_SUB];for(var d in f){var c=f[d];if(c[MENU_IDX_ID]==e[g]){if(m&&(WH.inArray(m,e[g])<0)){delete c[MENU_IDX_OPT].tinyIcon;c[MENU_IDX_OPT].className="q0";c[MENU_IDX_URL]="javascript:;"}else{c[MENU_IDX_URL]=WH.classSpecBtnOnChange.bind(this,h,e[g],false)}break}}}}this._classSpecBtn.menu=b};WH.getClassFromSpec=function(d){for(var c in g_chr_specs_by_class){if(!g_chr_specs_by_class.hasOwnProperty(c)){continue}for(var b=0,a;a=g_chr_specs_by_class[c][b];b++){if(a==d){return c}}}return null};WH.getRealStatIdForSpec=function(d,c,b){var a;var e;if(d==71){e=0;if(!b){return 5}while(1){a=c[e];if(a>=3){if(a<=5){break}}++e;if(e>=b){return 5}}}else{if(d!=72){if(d!=73){if(d!=74){return d}e=0;if(b){while(1){a=c[e];if(a>=4){if(a<=5){break}}++e;if(e>=b){return 5}}return a}return 5}e=0;if(b){while(1){a=c[e];if(c[e]==3){break}if(c[e]==5){break}++e;if(e>=b){return 5}}return a}return 5}e=0;if(!b){return 3}while(1){a=c[e];if(a>=3){if(a<=4){break}}++e;if(e>=b){return 3}}}return a};WH.bonusesBtnShouldShow=function(a){for(var b in a){if(a.hasOwnProperty(b)){return true}}return false};WH.bonusesBtnBuildMenu=function(h){var b=[];var o=h.bonusesData;if(o){for(var m in o){var q=o[m].groupedUpgrade;var p=WH.getItemBonusName.call(this,m,h);var a=[m,p,WH.bonusesBtnOnChange.bind(this,(q?"u:":"")+m,false)];if(typeof q=="undefined"){for(var g in o[m].sub){q=o[m].sub[g].groupedUpgrade;p=WH.getItemBonusName.call(this,g,h,m);if(p=="???"){continue}var f=[g,p,WH.bonusesBtnOnChange.bind(this,m+":"+(q?"u:":"")+g,false,true)];if(!a[MENU_IDX_SUB]){a[MENU_IDX_SUB]=[]}a[MENU_IDX_SUB].push(f)}}if(a[MENU_IDX_SUB]){a[MENU_IDX_SUB].sort(function(s,r){var u=WH.getItemBonusChanceType(s[MENU_IDX_ID]);var t=WH.getItemBonusChanceType(r[MENU_IDX_ID]);return WH.stringCompare(u,t)||WH.stringCompare(s[MENU_IDX_NAME],r[MENU_IDX_NAME])});var e=[];var l=0;for(var j=0;j<a[MENU_IDX_SUB].length;++j){var g=a[MENU_IDX_SUB][j][MENU_IDX_ID];if(g&&o[m].sub[g].type!=l){l=o[m].sub[g].type;var k=LANG.unknown;switch(l){case 1:k=LANG.upgrades;break;case 2:k=LANG.su_note_stats;break;case 4:k=LANG.sockets;break;default:break}e.push([j,k])}}for(var j=0;j<e.length;++j){var n=e[j][0]+j;var d=[null,e[j][1]];a[MENU_IDX_SUB].splice(n,0,d)}}b.push(a)}b.sort(function(t,r){var u=t[1].innerText?t[1].innerText:t[1];var s=r[1].innerText?r[1].innerText:r[1];return WH.stringCompare(u,s)})}var c=[[null,LANG.selectbonus]];if(b.length>0){c=c.concat(b)}return c};WH.getItemBonusChanceType=function(f){var e=0;if(f>0&&WH.isSet("g_itembonuses")&&g_itembonuses&&g_itembonuses[f]){var a=g_itembonuses[f];for(var c=0;c<a.length;++c){var b=a[c];var d=0;switch(b[0]){case 1:case 3:case 4:case 5:case 11:d=1;break;case 2:d=2;break;case 6:d=4;break;default:break}if(d&&(!e||d<e)){e=d}}}return e};WH.getItemBonusUpgradeType=function(d){if(d>0&&WH.isSet("g_itembonuses")&&g_itembonuses&&g_itembonuses[d]){var a=g_itembonuses[d];for(var c=0;c<a.length;++c){var b=a[c];switch(b[0]){case 3:case 4:case 5:case 11:return 1<<b[0];default:break}}}return 0};WH.getItemBonusName=function(g,p,f){var h="";var c=p.level;if(f&&WH.isSet("g_itembonuses")&&f>0&&g_itembonuses[f]){for(var d=0;d<g_itembonuses[f].length;++d){var l=g_itembonuses[f][d];if(l[0]==1){c+=l[1]}}}if(WH.isSet("g_itembonuses")&&g>0&&g_itembonuses[g]){var e=g_itembonuses[g].slice();e.sort(function(q,j){return q[0]-j[0]});var a="";var o="";for(var d=0;d<e.length;++d){var l=e[d];switch(l[0]){case 1:a=LANG.itemlevel+" "+(c+l[1]);break;case 2:h+=(h?" / ":"")+((WH.statToJson[l[1]]&&LANG.traits[WH.statToJson[l[1]]])?LANG.traits[WH.statToJson[l[1]]][1]:"Unknown stat");break;case 3:o=l[1];break;case 4:if(WH.isSet("g_item_namedescriptions")&&g_item_namedescriptions[l[1]]){h+=(h?" / ":"")+g_item_namedescriptions[l[1]][0]}break;case 5:if(WH.isSet("g_item_namedescriptions")&&g_item_namedescriptions[l[1]]){h=g_item_namedescriptions[l[1]][0]}break;case 6:var k=l[2];h+=(h?" / ":"")+l[1]+" "+(g_socket_names[k]||(g_gem_types[k]?WH.sprintf(LANG.tooltip_emptyrelicslot.replace("%s","$1"),g_gem_types[k]):"Unknown Socket"));break;case 8:h+=(h?" / ":"")+WH.sprintf(LANG.tooltip_reqlevel_format.replace("%s","$1"),p.reqlevel+l[1]);break;case 11:if(p.heirloombonuses){var m="?";for(var b=0,n;n=p.heirloombonuses[b];b++){if(parseInt(g)===n){m=b+1;break}}h+=(h?" / ":"")+WH.sprintf(LANG.heirloomupgrade_format,m)}break;case 13:a=LANG.filters_spells.scaling;break;case 14:if(p.actualBonusLevels&&p.actualBonusLevels[g]){a=LANG.itemlevel+" "+p.actualBonusLevels[g]+"+"}else{a=LANG.itemlevel+" "+l[1]+"+"}break;default:break}}h+=(a?" / "+a:"")+((o&&p.quality!=o)?" / "+g_item_qualities[o]:"");if(h.substr(0,3)==" / "){h=h.substr(3)}}else{if(g=="0"){h=LANG.normal}}return h?h:(f?"???":LANG.normal)};WH.bonusesBtnGetContextBonusId=function(c){var b=0;if(c&&c.length){for(var a=0;a<c.length;++a){if(WH.isSet("g_itembonuses")&&g_itembonuses["-1"].indexOf(parseInt(c[a]))!=-1){b=c[a];break}}}return b};WH.bonusesBtnIsComboValid=function(g,d,h){if(!g[d]||!g[d].sub){return false}var e=g[d].sub;var f=32768;var c=32768;for(var a in h){var j=h[a];if(j!=d){if(e[j]){if((f&e[j].type)==1){}else{if(f&e[j].type){f=false;break}else{f|=e[j].type}}if(c&e[j].upgradeType){c=false;break}else{c|=e[j].upgradeType}}else{f=false;break}}}return f&&c};WH.bonusesGetItem=function(){var a=WH.getDataSource();var b=this._bonusesBtn.ttId;return a[b]};WH.bonusesGetDefaultAdjustmentBonus=function(c){var b=WH.bonusesGetItem.call(this);var a=WH.bonusesBtnGetContextBonusId(c);if(b.defaultAdjustmentBonuses[a]){return b.defaultAdjustmentBonuses[a].toString()}return null};WH.bonusesBtnOnChange=function(M,V,c){var z=WH.getDataSource();var A=this._bonusesBtn.ttId;var L=z[A].bonusesData;if(c===true){var f=M.split(":");var C=0;var x=f.indexOf("u");if(x!=-1){C=f[x+1];f.splice(x,1)}var n=f[0];var J=!Menu.findItem(this._bonusesBtn.menu,f).checked;var P=0;var r=[];WH.arrayWalk(this._bonusesBtn.menu,function(j){if(j.checked){P=j[MENU_IDX_ID];if(j[MENU_IDX_SUB]){WH.arrayWalk(j[MENU_IDX_SUB],function(ac){if(ac[MENU_IDX_ID]&&ac.checked){r.push(ac[MENU_IDX_ID]);if(P==n&&L[P].sub[ac[MENU_IDX_ID]].groupedUpgrade&&!C){C=ac[MENU_IDX_ID]}}})}}});var e;if(P==n){if(J){e=r.concat(f)}else{r.splice(r.indexOf(f[1]),1);e=r.concat([n])}}else{e=f}e.sort(function(ac,j){return ac-j});if(!WH.bonusesBtnIsComboValid(L,n,e)){e=f;var E=L[n].sub[f[1]].type;var K=L[n].sub[f[1]].upgradeType;for(var X=0;X<r.length;++X){if(E!=L[n].sub[r[X]].type){e.push(r[X])}else{if(K!=L[n].sub[r[X]].upgradeType){e.push(r[X])}}}e.sort(function(ac,j){return ac-j})}if(C){var F=e.indexOf(C);if(F!=-1){e.splice(e.indexOf(C),0,"u")}}M=e.join(":").replace(/^0:/,"")}this._bonusesBtn.selectedBonus=M;var I=this._bonusesBtn.selectedBonus.split(":");var Q=WH.bonusesGetDefaultAdjustmentBonus.call(this,I);if(Q!=null){var O=false;for(var X in I){var v=I[X];if(1372<=v&&v<=1672){O=true}}if(!O){I.push(Q);this._bonusesBtn.selectedBonus=I.join(":")}}var x=I.indexOf("u");if(x!=-1){I.splice(x,1)}$(this._bonusesBtn).html("");var q=WH.bonusesBtnGetContextBonusId(I);WH.arrayWalk(this._bonusesBtn.menu,function(j){j.checked=j[MENU_IDX_ID]==q;if(j[MENU_IDX_SUB]){WH.arrayWalk(j[MENU_IDX_SUB],function(ac){if(ac[MENU_IDX_ID]){ac.checked=j.checked&&I.indexOf(ac[MENU_IDX_ID])!=-1;if(ac.$a){ac[MENU_IDX_OPT]=null;Menu.updateItem(ac)}}})}});var aa=Menu.findItem(this._bonusesBtn.menu,[q]);if(aa&&aa[MENU_IDX_SUB]){WH.arrayWalk(aa[MENU_IDX_SUB],function(ac){if(ac[MENU_IDX_ID]){var j=I;if(I.indexOf(ac[MENU_IDX_ID])==-1){j=j.concat([ac[MENU_IDX_ID]])}j.sort(function(ae,ad){return ae-ad});if(!WH.bonusesBtnIsComboValid(L,q,j)&&I.indexOf(Q)==-1){ac[MENU_IDX_OPT]={"class":"q0"}}else{ac[MENU_IDX_OPT]={}}Menu.updateItem(ac)}})}var w=WH.getItemBonusName.call(this,q,z[A]);for(var X=0;X<I.length;++X){if(I[X]!=q&&I[X]!=Q){w+=" + "+WH.getItemBonusName.call(this,I[X],z[A],q)}}$(this._bonusesBtn).append(w);var t=0;if(WH.isSet("g_itembonuses")&&g_items&&g_items[A]){for(var X in I){var p=I[X];if(g_itembonuses[p]){for(var W=0;W<g_itembonuses[p].length;++W){var B=g_itembonuses[p][W];if(B[0]==7&&g_items[A].appearances&&g_items[A].appearances[B[1]]){t=g_items[A].appearances[B[1]][0];break}}}}}var Z=$("#d1c4b6d5a978ecb63b47c2e6a45e3389");if(Z.length>0){var k="/upgrade?items=0;"+A;if(I.length>0){k+=Array(10).join(".0")+"."+I.join(".")}Z.get(0).href=k}var R=$("#e8c7e052e3e0");if(R.length>0){var m=R.get(0).attributes.onclick.value;var h=new RegExp("\\(this, "+A+", \\[[^\\]]*?],");if(h.test(m)){var N=[];for(var g in I){var l=I[g];if(l==0){N.push(l);continue}var U=WH.isSet("g_itembonuses")&&g_itembonuses[l]?g_itembonuses[l]:[];for(var y in U){if(!U.hasOwnProperty(y)){continue}var ab=U[y][0];var H=U[y][1];if(WH.inArray([1,2,6,14],ab)!=-1){if(ab==2&&WH.inArray([61,62,63,64,66],H)!=-1){continue}N.push(l)}}}R.get(0).attributes.onclick.value=m.replace(h,"(this, "+A+", ["+N.join(",")+"],")}}var Y=$("#ic"+A);if(Y.length>0&&g_items){var T=g_items.getIcon(A,I);if(T){Y[0].removeChild(Y[0].firstChild);Y[0].appendChild(Icon.create(T,2))}}var b=$("#dsgndslgn464d");if(b.length>0){var o=b[0].attributes.onclick.value;if(!b[0]._defaultDisplayId){var h=new RegExp("displayId: (\\d+),","g");var D=h.exec(o);if(D){b[0]._defaultDisplayId=D[1]}}if(!t&&b[0]._defaultDisplayId){t=b[0]._defaultDisplayId}if(t){b[0].attributes.onclick.value=o.replace(/displayId: \d+/,"displayId: "+t)}}var u=$("#e8c6e055e3e0");if(u.length>0){var o=u[0].attributes.onclick.value;var a="";if(I.length>0){var s=[];while(s.length<9){s.push(0)}for(var X=0;X<I.length;++X){s.push(I[X])}a="."+s.join(".")}u[0].attributes.onclick.value=o.replace(/su_addToSaved\("?(\d+)[.\w]*"?, 1\)/,'su_addToSaved("$1'+a+'", 1)')}if(window.history){var G=this._bonusesBtn.selectedBonus.replace(/u:/,"");if(location.pathname.indexOf("&bonus")!=-1){window.history.replaceState({},"",location.pathname.replace(/&bonus=\d+(:\d+)*/,"&bonus="+G)+location.hash)}else{if(!location.hash){window.history.replaceState({},"",location.pathname+"&bonus="+G)}else{window.history.replaceState({},"",location.pathname+"&bonus="+G+location.hash)}}}WH.updateItemStringLink.call(this);if(!V&&z[A]["tooltip_"+Locale.getName()]){var d=WH.ge("sl"+A);d.innerHTML="";this.slider=null;var S=WH.enhanceTooltip.call(this,A,true,true,d,null,this._knownSpells,WH.ge("ks"+A),this._selectedUpgrade,null,null,true,null,null,this._bonusesBtn.selectedBonus);WH.updateTooltip.call(this,S)}};WH.updateItemStringLink=function(){var j=WH.getDataSource();var n=WH.isSet("g_pageInfo")?g_pageInfo.typeId:null;if(j[n]){var d="";var h=[];if(this._bonusesBtn&&this._bonusesBtn.selectedBonus){d=this._bonusesBtn.selectedBonus.replace(/u:/,"");h=d.split(":")}var b=(typeof this._selectedUpgrade=="number")?this._selectedUpgrade:0;var a=(j[n].upgradeData.length>0)?j[n].upgradeData[b].id:"";var q=this._selectedLevel?this._selectedLevel:WH.maxLevel;var o=this._knowledgeLevel?this._knowledgeLevel:0;var p=(this._classSpecBtn&&this._classSpecBtn.selectedSpec)?this._classSpecBtn.selectedSpec:"";var c=0;var f="";if(a){c|=4;f=(f?":":"")+a}else{if(h.length&&g_itembonuses){bonus_check_block:for(var k=0,m;m=h[k];k++){if(!g_itembonuses[m]){continue}for(var l=0,g;g=g_itembonuses[m][l];l++){if(g[0]==11||g[0]==13){c|=512;f=(f?":":"")+q;break bonus_check_block}}}}}if(o){c|=8388608;f=(f?":":"")+(o+1)}var e=""+(c?c:"")+"::"+(h.length?h.length+":":"")+d+":"+f;$("#open-links-button").click(function(){this.blur();var r={type:3,typeId:n,linkColor:"ff"+g_items.getItemQualityColor(j[n].quality),linkId:"item:"+n+"::::::::"+q+":"+p+":"+e,linkName:j[n]["name_"+Locale.getName()],bonuses:h,slot:j[n].slot};if(q!=WH.maxLevel){r.lvl=q}if(p){r.spec=p}if(sliderControl=WH.ge("sl"+n)){r.dropLevel=$(sliderControl).find("input").val()}Links.show(r)})}};WH.upgradeItemTooltip=function(d,j){var c=WH.getDataSource();var g=g_pageInfo.typeId;if(c[g]){var e=$("#"+d.id+" > input");var a=null;if(typeof j!="number"){e.each(function(k,l){if(l.id.indexOf(j)!=-1){a=l;return false}})}else{a=e.get(j-1)}var h=a.checked;e.each(function(k,l){l.checked=false});a.checked=h;if(!h){j=null}this._selectedUpgrade=j;WH.updateItemStringLink.call(this);if(c[g]["tooltip_"+Locale.getName()]){var f=this._bonusesBtn&&this._bonusesBtn.selectedBonus?this._bonusesBtn.selectedBonus:null;var b=WH.enhanceTooltip.call(this,g,true,true,false,null,this._knownSpells,WH.ge("ks"+g),j,null,null,true,null,null,f);WH.updateTooltip.call(this,b)}}};WH.updateTooltip=function(a){this.innerHTML="<table><tr><td>"+a+'</td><th style="background-position: top right"></th></tr><tr><th style="background-position: bottom left"></th><th style="background-position: bottom right"></th></tr></table>';WH.Tooltip.fixSafe(this,1,1)};WH.staticTooltipLevelClick=function(b,c,h,m){while(b.className.indexOf("tooltip")==-1){b=b.parentNode}var k=b.innerHTML;k=k.match(/<!--i?\?(\d+):(\d+):(\d+):(\d+)/);if(!k){return}var g=parseInt(k[1]),a=parseInt(k[2]),j=parseInt(k[3]),e=parseInt(k[4]);if(a>=j){return}if(!c){c=prompt(WH.sprintf(LANG.prompt_ratinglevel,a,j),e)}c=parseInt(c);if(isNaN(c)){return}if(c==e||c<a||c>j){return}b._selectedLevel=c;var d=WH.getDataSource();k=(WH.setTooltipLevel.bind(b,d[g][(m?"buff_":"tooltip_")+Locale.getName()],c,m))();var f=b._bonusesBtn&&b._bonusesBtn.selectedBonus?b._bonusesBtn.selectedBonus:null;var l=b._selectedUpgrade?b._selectedUpgrade:0;k=WH.enhanceTooltip.call(b,k,true,null,null,null,null,null,l,null,null,null,null,null,f);WH.updateTooltip.call(b,k);if(b.slider&&!h){Slider.setValue(b.slider,c)}if(!m){(WH.tooltipSpellsChange.bind(b))()}};WH.staticTooltipKnowledgeLevelClick=function(h,g,e){while(h.className.indexOf("tooltip")==-1){h=h.parentNode}var c=h.innerHTML;if(!g){WH.Tooltip.hide();g=prompt(WH.sprintf(LANG.prompt_ratinglevel,0,g_artifact_knowledge_max_level),h._knowledgeLevel?h._knowledgeLevel:0)}g=parseInt(g);if(isNaN(g)){return}if(g<0||g>g_artifact_knowledge_max_level){return}h._knowledgeLevel=g;if(window.history){var b=g?"&artk="+g:"";if(location.pathname.indexOf("&artk=")!=-1){window.history.replaceState({},"",location.pathname.replace(/&artk=\d+/,b)+location.hash)}else{window.history.replaceState({},"",location.pathname+b+location.hash)}}var a=WH.getDataSource();c=(WH.setTooltipLevel.bind(h,a[e]["tooltip_"+Locale.getName()],h._selectedLevel,null))();var f=h._bonusesBtn&&h._bonusesBtn.selectedBonus?h._bonusesBtn.selectedBonus:null;var d=h._selectedUpgrade?h._selectedUpgrade:0;c=WH.enhanceTooltip.call(h,c,true,null,null,null,null,null,d,null,null,null,null,null,f);WH.updateTooltip.call(h,c)};WH.tooltipSliderMove=function(c,b,a){WH.staticTooltipLevelClick(this,a.value,1);if(this.bufftip){WH.staticTooltipLevelClick(this.bufftip,a.value,1,1)}WH.Tooltip.hide()};WH.tooltipSpellsChange=function(){if(!this.modified){return}var c=this.modified[0],a=this.modified[1],b=[];$.each($("input:checked",c),function(d,e){b.push(parseInt(e.id.replace("known-","")))});this.modified[2]=b;this.innerHTML=WH.setTooltipSpells(this.innerHTML,b,a);if(this.bufftip){(WH.tooltipSpellsChange.bind(this.bufftip))()}};WH.tooltipRPPMChange=function(b){var a=$(this).attr("id").match(/\d+$/)[0];b.innerHTML=b.innerHTML.replace(/<!--rppm-->(\[?)(\d+(?:\.\d+)?)([^<]*)<!--rppm-->/,function(c,f,e,d){return"<!--rppm-->"+f+(b._rppmModBase*(1+parseFloat(b._rppmSpecModList[a].modifiervalue))).toFixed(2)+d+"<!--rppm-->"})};WH.validateBpet=function(j,d){var a=1,h=25,k=25,b=0,f=4,e=3,l=(1<<10)-1,c=3,g=$.extend({},d);if(j.minlevel){a=j.minlevel}if(j.maxlevel){h=j.maxlevel}if(j.companion){h=a}if(!g.level){g.level=k}g.level=Math.min(Math.max(g.level,a),h);if(j.minquality){b=j.minquality;if(j.untameable){f=b}}if(j.maxquality){f=j.maxquality}if(g.quality==null){g.quality=e}g.quality=Math.min(Math.max(g.quality,b),f);if(j.companion){delete (g.quality)}if(j.breeds>0){l=j.breeds&l}if(!(l&(1<<c-3))){c=Math.floor(3+Math.log(l)/Math.LN2)}if(g.breed&&g.breed>=13){g.breed-=10}if(!g.breed||!(l&(1<<g.breed-3))){g.breed=c}return g};WH.calcBattlePetStats=function(j,c,k,a,d){if(!WH.battlePetBreedStats[c]){c=3}var h=j.health;if(isNaN(h)){h=0}var b=j.power;if(isNaN(b)){b=0}var f=j.speed;if(isNaN(f)){f=0}if(isNaN(k)){k=1}k=Math.min(Math.max(0,k),5);if(isNaN(a)){a=1}a=Math.min(Math.max(1,a),25);var e=WH.battlePetBreedStats[c];var g=1+(k/10);h=((h+e[0])*5*a*g)+100;b=(b+e[1])*a*g;f=(f+e[2])*a*g;if(d){h=h*5/6;b=b*4/5}return{health:Math.round(h),power:Math.round(b),speed:Math.round(f)}};WH.battlePetBreedStats={3:[0.5,0.5,0.5],4:[0,2,0],5:[0,0,2],6:[2,0,0],7:[0.9,0.9,0],8:[0,0.9,0.9],9:[0.9,0,0.9],10:[0.4,0.9,0.4],11:[0.4,0.4,0.9],12:[0.9,0.4,0.4]};WH.battlePetAbilityLevels=[1,2,4,10,15,20];WH.Tooltip={showingTooltip:false,create:function(j,l){var g=WH.ce("div"),n=WH.ce("table"),c=WH.ce("tbody"),f=WH.ce("tr"),b=WH.ce("tr"),a=WH.ce("td"),m=WH.ce("th"),k=WH.ce("th"),h=WH.ce("th");g.className="wowhead-tooltip";m.style.backgroundPosition="top right";k.style.backgroundPosition="bottom left";h.style.backgroundPosition="bottom right";if(j){a.innerHTML=j}WH.ae(f,a);WH.ae(f,m);WH.ae(c,f);WH.ae(b,k);WH.ae(b,h);WH.ae(c,b);WH.ae(n,c);if(!l){WH.Tooltip.icon=WH.ce("p");WH.Tooltip.icon.style.visibility="hidden";WH.ae(WH.Tooltip.icon,WH.ce("div"));WH.ae(g,WH.Tooltip.icon)}WH.ae(g,n);if(!l){var e=WH.ce("div");WH.ae(e,WH.ct("Powered by"));e.className="wowhead-tooltip-powered";WH.ae(g,e);WH.Tooltip.logo=e}return g},getMultiPartHtml:function(b,a){return"<table><tr><td>"+b+"</td></tr></table><table><tr><td>"+a+"</td></tr></table>"},fix:function(k,b,d){var j=WH.gE(k,"table")[0],f=WH.gE(j,"td")[0],g=f.childNodes;k.className=WH.trim(k.className.replace("tooltip-slider",""));if(g.length>=2&&g[0].nodeName=="TABLE"&&g[1].nodeName=="TABLE"){g[0].style.whiteSpace="nowrap";var e=parseInt(k.style.width);if(!k.slider||!e){if(g[1].offsetWidth==0){e=320}else{if(g[1].offsetWidth>300){e=Math.max(300,g[0].offsetWidth)+20}else{e=Math.max(g[0].offsetWidth,g[1].offsetWidth)+20}}}for(var h=2;h<g.length;h++){if(g[h].nodeName=="BLOCKQUOTE"){e=Math.max(e,g[h].offsetWidth+20)}}e=Math.min(320,e);if(e>20){k.className+=" wowhead-tooltip-width-restriction wowhead-tooltip-width-"+e;k.style.width=e+"px";g[0].style.width=g[1].style.width="100%";if(k.slider){Slider.setSize(k.slider,e-6);k.className+=" tooltip-slider"}if(!b&&k.offsetHeight>document.body.clientHeight){j.className="shrink"}}}else{if(g.length>=1&&k.slider){var a=g[0].nodeName=="TABLE";if(a){g[0].style.whiteSpace="nowrap"}var e=parseInt(k.style.width);if(!e&&a){e=g[0].offsetWidth+20}else{e=j.offsetWidth+20}e=Math.min(320,e);if(e>20){k.style.width=e+"px";if(a){g[0].style.width="100%"}if(k.slider){Slider.setSize(k.slider,e-6);k.className+=" tooltip-slider"}if(!b&&k.offsetHeight>document.body.clientHeight){j.className="shrink"}}}}if(d){WH.Tooltip.setTooltipVisibility(k,true)}},fixSafe:function(c,b,a){WH.Tooltip.fix(c,b,a)},attachImage:function(d,e,h,k){if(typeof k=="undefined"){k=""}if(typeof jQuery!="undefined"){jQuery(d.parentNode).children(".image"+k).remove()}else{var l=new RegExp("\\bimage"+k+"\\b");for(var g=0;g<d.parentNode.childNodes.length;g++){if(l.test(d.parentNode.childNodes[g].className)){d.parentNode.removeChild(d.parentNode.childNodes[g]);g--}}}var j=typeof e;if(j=="number"){var f=WH.getDataSource(),b=e;if(f[b]&&f[b]["image_"+Locale.getName()+k]){e=f[b]["image_"+Locale.getName()+k]}else{return}}else{if(j!="string"){return}}var a=WH.ce("div");a.className="image"+k+(h?" "+h:"");a.style.backgroundImage="url("+e+")";if(typeof jQuery!="undefined"){jQuery(d).after(a)}else{d.parentNode.insertBefore(a,d.nextSibling)}},append:function(e,b,a,d){var e=WH.ge(e);var f=WH.Tooltip.create(b,a);if(d){var c=WH.ce("p");c.style.backgroundImage="url("+WH.staticUrl+"/images/wow/icons/medium/"+d.toLowerCase()+".jpg)";WH.ae(c,WH.ce("div"));WH.ae(f,c)}WH.ae(e,f);WH.Tooltip.fixSafe(f,1,1)},reset:function(){if(WH.Tooltip.tooltip){WH.Tooltip.tooltip.parentNode.removeChild(WH.Tooltip.tooltip);WH.Tooltip.tooltip=null}if(WH.Tooltip.tooltip2){WH.Tooltip.tooltip2.parentNode.removeChild(WH.Tooltip.tooltip2);WH.Tooltip.tooltip2=null}},prepare:function(b){if(WH.Tooltip.tooltip){return}var c=(typeof b!="undefined")?b:document.body;var a=WH.Tooltip.create();a.style.position="absolute";a.style.left=a.style.top="-2323px";WH.ae(c,a);WH.Tooltip.tooltip=a;WH.Tooltip.tooltipTable=WH.gE(a,"table")[0];WH.Tooltip.tooltipTd=WH.gE(a,"td")[0];var a=WH.Tooltip.create(null,true);a.style.position="absolute";a.style.left=a.style.top="-2323px";WH.ae(c,a);WH.Tooltip.tooltip2=a;WH.Tooltip.tooltipTable2=WH.gE(a,"table")[0];WH.Tooltip.tooltipTd2=WH.gE(a,"td")[0]},prepareScreen:function(){if(WH.Tooltip.screen){WH.Tooltip.screen.style.display="block"}else{WH.Tooltip.screen=WH.ce("div",{id:"wowhead-tooltip-screen",className:"wowhead-tooltip-screen"});WH.Tooltip.screenCloser=WH.ce("a",{id:"wowhead-tooltip-screen-close",className:"wowhead-tooltip-screen-close",onclick:$WowheadPower.clearTouchTooltip});WH.Tooltip.screenInnerWrapper=WH.ce("div",{id:"wowhead-tooltip-screen-inner-wrapper",className:"wowhead-tooltip-screen-inner-wrapper"});WH.Tooltip.screenInner=WH.ce("div",{id:"wowhead-tooltip-screen-inner",className:"wowhead-tooltip-screen-inner"});WH.Tooltip.screenInnerBox=WH.ce("div",{id:"wowhead-tooltip-screen-inner-box",className:"wowhead-tooltip-screen-inner-box"});WH.Tooltip.screenCaption=WH.ce("div",{id:"wowhead-tooltip-screen-caption",className:"wowhead-tooltip-screen-caption"});WH.ae(WH.Tooltip.screen,WH.Tooltip.screenCloser);WH.ae(WH.Tooltip.screenInner,WH.Tooltip.screenInnerBox);WH.ae(WH.Tooltip.screenInnerWrapper,WH.Tooltip.screenInner);WH.ae(WH.Tooltip.screen,WH.Tooltip.screenInnerWrapper);WH.ae(WH.Tooltip.screen,WH.Tooltip.screenCaption);WH.ae(document.body,WH.Tooltip.screen)}WH.Tooltip.mobileTooltipShown=true;WH.Tooltip.setupIScroll()},destroyIScroll:function(){if(WH.Tooltip.iScroll){WH.Tooltip.iScroll.destroy();WH.Tooltip.iScroll=null}},setupIScroll:function(){if(!WH.Tooltip.mobileScrollSetUp){var a=function(b){if(WH.Tooltip.mobileTooltipShown){if(!document.getElementById("wowhead-tooltip-screen-inner").contains(b.target)){b.preventDefault()}}};WH.aE(document.body,"touchmove",a);WH.aE(document.body,"mousewheel",a);WH.Tooltip.mobileScrollSetUp=true}if(typeof IScroll!="function"){return}setTimeout(function(){WH.Tooltip.destroyIScroll();WH.Tooltip.iScroll=new IScroll(WH.Tooltip.screenInnerWrapper,{mouseWheel:true,tap:true})},1)},setTooltipVisibility:function(a,b){if(b){a.setAttribute("data-visible","yes");a.style.visibility="visible"}else{a.setAttribute("data-visible","no");a.style.visibility="hidden"}},set:function(g,d,f,c){var b=WH.Tooltip.tooltip;b.style.width="550px";b.style.left="-2323px";b.style.top="-2323px";WH.Tooltip.tooltip.className="wowhead-tooltip";if(g.nodeName){WH.ee(WH.Tooltip.tooltipTd);WH.ae(WH.Tooltip.tooltipTd,g)}else{WH.Tooltip.tooltipTd.innerHTML=g}b.style.display="";WH.Tooltip.setTooltipVisibility(b,true);WH.Tooltip.fix(b,0,0);if(d){WH.Tooltip.showSecondary=true;var b=WH.Tooltip.tooltip2;b.style.width="550px";b.style.left="-2323px";b.style.top="-2323px";if(d.nodeName){WH.ee(WH.Tooltip.tooltipTd2);WH.ae(WH.Tooltip.tooltipTd2,d)}else{WH.Tooltip.tooltipTd2.innerHTML=d}b.style.display="";WH.Tooltip.fix(b,0,0)}else{WH.Tooltip.showSecondary=false}var a=null;if(typeof Platform!=="undefined"){a=Platform.isTouch()}else{if(typeof WH!=="undefined"){a=WH.isTouch()}}if(a){var e=WH.Tooltip.showSecondary?WH.Tooltip.tooltipTd2:WH.Tooltip.tooltipTd;var h=WH.ce("a");h.href="javascript:;";h.className="wowhead-touch-tooltip-closer";h.onclick=$WowheadPower.clearTouchTooltip;WH.ae(e,h)}WH.Tooltip.tooltipTable.style.display=(g=="")?"none":"";WH.Tooltip.attachImage(WH.Tooltip.tooltipTable,f,c);WH.Tooltip.generateEvent("show")},displayTooltip:function(b,d,a,c){$WowheadPower.displayTooltip(b,d,a,c)},moveTests:[[null,null],[null,false],[false,null],[false,false]],move:function(o,n,e,q,d,b){if(!WH.Tooltip.tooltipTable){return}var r=WH.Tooltip.tooltip,j=WH.Tooltip.tooltipTable.offsetWidth,c=WH.Tooltip.tooltipTable.offsetHeight,l=WH.Tooltip.tooltip2,g=WH.Tooltip.showSecondary?WH.Tooltip.tooltipTable2.offsetWidth:0,a=WH.Tooltip.showSecondary?WH.Tooltip.tooltipTable2.offsetHeight:0,p;r.style.width=(j==0)?"auto":(j+"px");l.style.width=g+"px";var m,f;for(var h=0,k=WH.Tooltip.moveTests.length;h<k;++h){p=WH.Tooltip.moveTests[h];m=WH.Tooltip.moveTest(o,n,e,q,d,b,p[0],p[1]);if(WH.isSet("WAS")&&!WAS.intersect(m)){f=true;break}else{if(!WH.isSet("WAS")){break}}}if(WH.isSet("WAS")&&!f){WAS.intersect(m,true)}r.style.left=m.l+"px";r.style.top=m.t+"px";WH.Tooltip.setTooltipVisibility(r,true);if(WH.Tooltip.showSecondary){l.style.left=m.l+j+"px";l.style.top=m.t+"px";WH.Tooltip.setTooltipVisibility(l,true)}WH.Tooltip.generateEvent("move")},moveTest:function(e,m,r,n,b,a,o,l){var A=e,q=m,f=WH.Tooltip.tooltip,k=WH.Tooltip.tooltipTable.offsetWidth,t=WH.Tooltip.tooltipTable.offsetHeight,p=WH.Tooltip.tooltip2,z=WH.Tooltip.showSecondary?WH.Tooltip.tooltipTable2.offsetWidth:0,g=WH.Tooltip.showSecondary?WH.Tooltip.tooltipTable2.offsetHeight:0,j=WH.getWindowSize(),d=WH.getScroll(),h=j.w,s=j.h,c=d.x,y=d.y,x=c,w=y,v=c+h,u=y+s;if(o==null){o=(e+r+k+z<=v)}if(l==null){l=(m-Math.max(t,g)>=w)}if(o){e+=r+b}else{e=Math.max(e-(k+z),x)-b}if(l){m-=Math.max(t,g)+a}else{m+=n+a}if(e<x){e=x}else{if(e+k+z>v){e=v-(k+z)}}if(m<w){m=w}else{if(m+Math.max(t,g)>u){m=Math.max(y,u-Math.max(t,g))}}if(WH.Tooltip.iconVisible){if(A>=e-48&&A<=e&&q>=m-4&&q<=m+48){m-=48-(q-m)}}return WH.createRect(e,m,k,t)},show:function(f,j,c,a,b,d,e,h){if(WH.Tooltip.disabled){return}if(!c||c<1){c=1}if(!a||a<1){a=1}if(b){j='<span class="'+b+'">'+j+"</span>"}var g=WH.ac(f);WH.Tooltip.prepare();WH.Tooltip.set(j,d,e,h);WH.Tooltip.move(g.x,g.y,f.offsetWidth,f.offsetHeight,c,a)},showAtCursor:function(g,k,c,a,b,d,f,j){if(WH.Tooltip.disabled){return}if(!c||c<10){c=10}if(!a||a<10){a=10}if(b){k='<span class="'+b+'">'+k+"</span>";if(d){d='<span class="'+b+'">'+d+"</span>"}}g=WH.normalizeEvent(g);var h=WH.getCursorPos(g);WH.Tooltip.prepare();WH.Tooltip.set(k,d,f,j);WH.Tooltip.move(h.x,h.y,0,0,c,a)},showAtXY:function(g,a,h,d,b,e,f,c){if(WH.Tooltip.disabled){return}WH.Tooltip.prepare();WH.Tooltip.set(g,e,f,c);WH.Tooltip.move(a,h,0,0,d,b)},showInScreen:function(e,j,b,c,d,h,f){$WowheadPower.clearTouchTooltip(true);if(WH.Tooltip.disabled){return}if(b){j='<span class="'+b+'">'+j+"</span>"}WH.Tooltip.prepareScreen();WH.ee(WH.Tooltip.screenCaption);var g=WH.ce("a",{innerHTML:WH.isRemote()?"Tap Link":LANG.tooltip_taplink,onclick:(function(l,a){l.setAttribute("data-disable-wowhead-tooltip","true");if(l.fireEvent){l.fireEvent("on"+a)}else{if(typeof MouseEvent=="function"){l.dispatchEvent(new MouseEvent(a,{bubbles:true,cancelable:true}))}else{var m=document.createEvent("Events");m.initEvent(a,true,true);l.dispatchEvent(m)}}if(l){l.removeAttribute("data-disable-wowhead-tooltip")}$WowheadPower.clearTouchTooltip()}).bind(null,e,"click")});var k=WH.ce("i",{className:"fa fa-hand-o-up"});WH.aef(g,k);WH.ae(WH.Tooltip.screenCaption,g);$WowheadPower.setParent(WH.Tooltip.screenInnerBox);WH.Tooltip.setIcon(f);WH.Tooltip.set(j,c,d,h);WH.Tooltip.move()},cursorUpdate:function(b,a,d){if(WH.Tooltip.disabled||!WH.Tooltip.tooltip){return}b=WH.normalizeEvent(b);if(!a||a<10){a=10}if(!d||d<10){d=10}var c=WH.getCursorPos(b);WH.Tooltip.move(c.x,c.y,0,0,a,d)},hide:function(){if(WH.Tooltip.tooltip){WH.Tooltip.showingTooltip=false;WH.Tooltip.tooltip.style.display="none";WH.Tooltip.setTooltipVisibility(WH.Tooltip.tooltip,false);WH.Tooltip.tooltipTable.className="";WH.Tooltip.setIcon(null);if(WH.isSet("WAS")){WAS.restoreHidden()}WH.Tooltip.generateEvent("hide")}if(WH.Tooltip.tooltip2){WH.Tooltip.tooltip2.style.display="none";WH.Tooltip.setTooltipVisibility(WH.Tooltip.tooltip2,false);WH.Tooltip.tooltipTable2.className=""}},setIcon:function(a){WH.Tooltip.prepare();if(a){WH.Tooltip.icon.style.backgroundImage="url("+WH.staticUrl+"/images/wow/icons/medium/"+a.toLowerCase()+".jpg)";WH.Tooltip.icon.style.visibility="visible"}else{WH.Tooltip.icon.style.backgroundImage="none";WH.Tooltip.icon.style.visibility="hidden"}WH.Tooltip.iconVisible=a?1:0},generateEvent:function(a){if(!WH.Tooltip.tooltip){return}try{WH.Tooltip.tooltip.dispatchEvent(new Event(a))}catch(c){try{var b=document.createEvent("Event");b.initEvent(a,true,true);WH.Tooltip.tooltip.dispatchEvent(b)}catch(c){void (0)}}},addTooltipText:function(a,c,b){if(!a){WH.error("Tooltip text addition element not found!",a,c,b);return}a._fixTooltip=(function(f,l,h,e){var g=/<\/table>\s*$/;var k=typeof h==="function"?h():h;var j=h?' class="'+k+'"':"";var d=typeof l==="function"?l():l;if(g.test(e)){return e.replace(g,'<tr><td colspan="2"><div'+j+' style="margin-top:10px">'+d+"</div></td></tr></table>")}else{return e+"<div"+j+' style="margin-top:10px">'+d+"</div>"}}).bind(null,a,c,b)},simple:function(c,j,f,a,g,e,h){if(c instanceof jQuery){for(var d=0,b;b=c[d];d++){WH.Tooltip.simple(b,j,f,a,g,e,h)}return}if(e){j='<div class="no-wrap">'+j+"</div>"}if(h&&!isNaN(h)){j='<div style="max-width:'+h+'px">'+j+"</div>"}if(a){if(g){c.onmouseover=function(k){WH.Tooltip.show(c,typeof j==="function"?j.call(this,k):j,false,false,f);k.stopPropagation()}}else{c.onmouseover=function(k){WH.Tooltip.show(c,typeof j==="function"?j.call(this,k):j,false,false,f)}}}else{if(g){c.onmouseover=function(k){WH.Tooltip.showAtCursor(k,typeof j==="function"?j.call(this,k):j,false,false,f);k.stopPropagation()}}else{c.onmouseover=function(k){WH.Tooltip.showAtCursor(k,typeof j==="function"?j.call(this,k):j,false,false,f)}}c.onmousemove=WH.Tooltip.cursorUpdate}c.onmouseout=WH.Tooltip.hide},simpleNonTouch:function(a,d,b,c,e){if(!Platform.isTouch()){WH.Tooltip.simple(a,d,b,c,false,e)}},simpleOverride:function(e,f,c,a,h,g,j,d,k,b,l){e.overrideTooltip={html:f,htmlGenerator:c,spanClass:a,icon:h,html2:g,html2Generator:j,image:d,imageClass:k,map:b,spellData:l}}};WH.createButton=function(l,d,o){var j="btn btn-site";var h="";var e="";var c="";var n="";var f=[];var m=[];if(!o){o={}}if(!o["no-margin"]){m.push("margin-left:5px")}if(typeof d!="string"||d===""){d="javascript:;"}if(o["new-window"]){h=' target="_blank"'}if(typeof o.id=="string"){e=' id="'+o.id+'"'}if(typeof o.size!="undefined"){switch(o.size){case"small":case"large":f.push("btn-"+o.size);break}}else{f.push("btn-small")}if(typeof o["class"]=="string"){f.push(o["class"])}if(typeof o.type=="string"){switch(o.type){case"default":case"gray":j="btn";break;default:j="btn btn-"+o.type}}if(o.disabled){f.push("btn-disabled");d="javascript:;"}if(f.length){j+=" "+f.join(" ")}if(j){j=' class="'+j+'"'}if(!(typeof o["float"]!="undefined"&&!o["float"])){m.push("float:right")}if(typeof o.style=="string"){m.push(o.style)}if(m.length){c=' style="'+m.join(";")+'"'}var g='<a href="'+d+'"'+h+e+j+c+">"+(l||"")+"</a>";var b=WH.ce("div");b.innerHTML=g;var k=b.childNodes[0];if(typeof o.click=="function"&&!o.disabled){k.onclick=o.click}if(typeof o.tooltip!="undefined"){if(o.tooltip!==false){k.setAttribute("data-whattach","true")}if(o.tooltip===false){k.rel="np"}else{if(typeof o.tooltip=="string"){WH.Tooltip.simple(k,o.tooltip,null,true)}else{if(typeof o.tooltip=="object"&&o.tooltip["text"]){WH.Tooltip.simple(k,o.tooltip["text"],o.tooltip["class"],true)}}}}return k};if(WH.isSet("$WowheadPower")){$WowheadPower.init()};